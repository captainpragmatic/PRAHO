{% extends 'base.html' %}
{% load i18n %}
{% load ui_components %}
{% load formatting %}

{% block title %}{{ service.name|default:service.domain }} - {% trans 'Service Details' %} - PRAHO Platform{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6">
    
    <!-- üöÄ Hero Section with Status -->
    <div class="bg-gradient-to-r from-slate-800 to-slate-700 rounded-xl p-6 mb-6 border border-slate-600">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="flex-1">
                <div class="flex items-center space-x-3 mb-2">
                    <h1 class="text-2xl md:text-3xl font-bold text-white">
                        {{ service.name|default:service.domain }}
                    </h1>
                    {% if service.status == 'active' %}
                      {% badge "Active" variant="success" icon="‚úÖ" %}
                    {% elif service.status == 'suspended' %}
                      {% badge "Suspended" variant="danger" icon="‚è∏Ô∏è" %}
                    {% elif service.status == 'cancelled' %}
                      {% badge "Cancelled" variant="secondary" icon="‚ùå" %}
                    {% elif service.status == 'pending' %}
                      {% badge "Pending" variant="warning" icon="‚è≥" %}
                    {% else %}
                      {% badge service.status|title variant="default" %}
                    {% endif %}
                </div>
                <p class="text-slate-300 text-lg">{{ service.domain }}</p>
                <div class="flex flex-wrap items-center text-slate-400 text-sm mt-2 space-x-2">
                    <span class="flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        {{ service.created_at|date:"d.m.Y H:i" }}
                    </span>
                    {% if service.updated_at != service.created_at %}
                        <span class="text-slate-500">‚Ä¢</span>
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            {{ service.updated_at|date:"d.m.Y H:i" }}
                        </span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Action Bar -->
            <div class="flex flex-wrap gap-2 mt-4 md:mt-0 mobile-stacked">
                {% if can_manage %}
                    {% if service.status == 'active' %}
                        {% url 'provisioning:service_suspend' service.pk as suspend_url %}
                        {% button "‚è∏Ô∏è Suspend" variant="danger" hx_post=suspend_url hx_confirm="Suspend this service?" hx_target="#service-status" class="sm:text-sm mobile-full-width" %}
                    {% elif service.status == 'suspended' %}
                        {% url 'provisioning:service_activate' service.pk as activate_url %}
                        {% button "‚ñ∂Ô∏è Activate" variant="success" hx_post=activate_url hx_confirm="Reactivate this service?" hx_target="#service-status" class="sm:text-sm mobile-full-width" %}
                    {% endif %}
                    {% url 'provisioning:service_edit' service.pk as edit_url %}
                    {% button "‚úèÔ∏è Edit" variant="secondary" href=edit_url class="sm:text-sm mobile-full-width" %}
                {% endif %}
                {% url 'provisioning:services' as services_url %}
                {% button "‚Üê Back to Services" variant="secondary" href=services_url class="sm:text-sm mobile-full-width" %}
            </div>
        </div>
    </div>

    <!-- üìä Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
        
        <!-- üè¢ Customer Information (Left Column) -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Customer Card -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 hover-lift transition-all duration-300">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white flex items-center">
                        üè¢ {% trans 'Customer' %}
                    </h3>
                    <span class="text-xs bg-green-600 text-white px-2 py-1 rounded-full">
                        üá∑üá¥ RO
                    </span>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <p class="text-sm text-slate-400">{% trans 'Company' %}</p>
                        <p class="font-medium text-white">{{ service.customer.company_name }}</p>
                    </div>
                    
                    <div>
                        <p class="text-sm text-slate-400">{% trans 'CUI' %}</p>
                        <div class="flex items-center space-x-2">
                            <p class="font-mono text-white">{{ service.customer.cui|cui_format }}</p>
                            <span class="text-xs bg-blue-600 text-white px-2 py-0.5 rounded">
                                ‚úÖ Valid
                            </span>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-slate-400">{% trans 'Contact' %}</p>
                        <p class="text-white">{{ service.customer.contact_name }}</p>
                        <a href="mailto:{{ service.customer.contact_email }}" class="text-blue-400 hover:text-blue-300 text-sm">
                            {{ service.customer.contact_email }}
                        </a>
                    </div>
                    
                    {% if service.customer.phone %}
                    <div>
                        <p class="text-sm text-slate-400">{% trans 'Phone' %}</p>
                        <p class="text-white">{{ service.customer.phone }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Billing Overview -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 hover-lift transition-all duration-300">
                <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                    üí∞ {% trans 'Billing' %}
                </h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">{% trans 'Monthly Price' %}</span>
                        <span class="text-white font-semibold">{{ service.service_plan.price_monthly|romanian_currency }}</span>
                    </div>
                    
                    {% if service.service_plan.price_quarterly %}
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">{% trans 'Quarterly Price' %}</span>
                        <span class="text-white">{{ service.service_plan.price_quarterly|romanian_currency }}</span>
                    </div>
                    {% endif %}
                    
                    {% if service.service_plan.price_yearly %}
                    <div class="flex justify-between items-center">
                        <span class="text-slate-400">{% trans 'Yearly Price' %}</span>
                        <span class="text-white">{{ service.service_plan.price_yearly|romanian_currency }}</span>
                    </div>
                    {% endif %}
                    
                    <div class="pt-3 border-t border-slate-700">
                        <div class="flex justify-between items-center">
                            <span class="text-slate-400">{% trans 'VAT (19%)' %}</span>
                            <span class="text-slate-300">{{ service.service_plan.price_monthly|romanian_vat:0.19 }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚öôÔ∏è Service Details (Right Column) -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Service Plan Card -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 hover-lift transition-all duration-300">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-white flex items-center">
                        üì¶ {% trans 'Service Plan' %}
                    </h3>
                    <span class="text-sm bg-purple-600 text-white px-3 py-1 rounded-full">
                        {{ service.service_plan.get_plan_type_display }}
                    </span>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                    <div>
                        <h4 class="font-medium text-white mb-2">{{ service.service_plan.name }}</h4>
                        <p class="text-slate-300 text-sm">{{ service.service_plan.description|default:"No description available"|truncatewords:20 }}</p>
                    </div>
                    
                    <div class="space-y-2">
                        {% if service.service_plan.disk_space_gb %}
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">{% trans 'Disk Space' %}</span>
                            <span class="text-white">{{ service.service_plan.disk_space_gb }} GB</span>
                        </div>
                        {% endif %}
                        
                        {% if service.service_plan.bandwidth_gb %}
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">{% trans 'Bandwidth' %}</span>
                            <span class="text-white">{{ service.service_plan.bandwidth_gb }} GB</span>
                        </div>
                        {% endif %}
                        
                        {% if service.service_plan.ram_gb %}
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">{% trans 'RAM' %}</span>
                            <span class="text-white">{{ service.service_plan.ram_gb }} GB</span>
                        </div>
                        {% endif %}
                        
                        {% if service.service_plan.cpu_cores %}
                        <div class="flex justify-between text-sm">
                            <span class="text-slate-400">{% trans 'CPU Cores' %}</span>
                            <span class="text-white">{{ service.service_plan.cpu_cores }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Technical Configuration -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                    ‚öôÔ∏è {% trans 'Configuration' %}
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                    <!-- Domain Configuration -->
                    <div class="space-y-3">
                        <h4 class="font-medium text-white text-sm uppercase tracking-wider">{% trans 'Domain' %}</h4>
                        <div class="bg-slate-700/50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-400 text-sm">{% trans 'Primary Domain' %}</span>
                                <span class="text-white font-mono text-sm">{{ service.domain }}</span>
                            </div>
                        </div>
                        
                        {% if service.primary_domain %}
                        <div class="bg-slate-700/50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-400 text-sm">{% trans 'Registered Domain' %}</span>
                                <span class="text-green-400 text-sm">‚úì Active</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Server Details -->
                    <div class="space-y-3">
                        <h4 class="font-medium text-white text-sm uppercase tracking-wider">{% trans 'Server' %}</h4>
                        <div class="bg-slate-700/50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-400 text-sm">{% trans 'Assigned Server' %}</span>
                                {% if service.server %}
                                <span class="text-white font-mono text-sm">{{ service.server.name }}</span>
                                {% else %}
                                <span class="text-yellow-400 text-sm">{% trans 'Not assigned' %}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if service.server %}
                        <div class="bg-slate-700/50 rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <span class="text-slate-400 text-sm">{% trans 'IP Address' %}</span>
                                <span class="text-white font-mono text-sm">{{ service.server.ip_address|default:"TBD" }}</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
            </div>

            <!-- Status Timeline -->
            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
                <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
                    üìà {% trans 'Status Timeline' %}
                </h3>
                
                <div class="space-y-4">
                    <!-- Current Status -->
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full 
                            {% if service.status == 'active' %}bg-green-600
                            {% elif service.status == 'suspended' %}bg-red-600
                            {% elif service.status == 'cancelled' %}bg-gray-600
                            {% else %}bg-yellow-600{% endif %} 
                            flex items-center justify-center">
                            <div class="w-3 h-3 bg-white rounded-full"></div>
                        </div>
                        <div>
                            <p class="text-white font-medium">{% trans 'Current Status' %}: 
                                {% if service.status == 'active' %}{% trans 'Active' %}
                                {% elif service.status == 'suspended' %}{% trans 'Suspended' %}
                                {% elif service.status == 'cancelled' %}{% trans 'Cancelled' %}
                                {% else %}{{ service.status|title }}{% endif %}
                            </p>
                            <p class="text-slate-400 text-sm">{% trans 'Last updated' %} {{ service.updated_at|date:"d.m.Y H:i" }}</p>
                        </div>
                    </div>
                    
                    <!-- Creation -->
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-white font-medium">{% trans 'Service Created' %}</p>
                            <p class="text-slate-400 text-sm">{{ service.created_at|date:"d.m.Y H:i" }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üîÑ HTMX Status Update Target -->
    <div id="service-status" class="hidden">
        <!-- HTMX will replace this content -->
    </div>

</div>


<!-- HTMX Loading Styles -->
<style>
.htmx-request .htmx-indicator {
    display: inline-flex !important;
}
.htmx-request .htmx-indicator-text {
    display: none !important;
}

/* Enhanced loading states */
.loading-shimmer {
    background: linear-gradient(90deg, #1e293b 0%, #334155 50%, #1e293b 100%);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.status-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Smooth transitions for HTMX swaps */
.htmx-added {
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
}

.htmx-added.htmx-added-end {
    opacity: 1;
    transform: translateY(0);
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
    .mobile-stacked {
        flex-direction: column;
        align-items: stretch;
    }
    
    .mobile-full-width {
        width: 100%;
    }
}

/* Enhanced hover states */
.hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
}

/* Status color coding */
.status-active { background-color: #16a34a; }
.status-suspended { background-color: #ca8a04; }
.status-cancelled { background-color: #dc2626; }
.status-pending { background-color: #d97706; }

/* üì± Progressive Enhancement - Skeleton Loading */
.skeleton {
    background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: 0.375rem;
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.skeleton-text {
    height: 1rem;
    width: 100%;
    margin-bottom: 0.5rem;
}

.skeleton-text-sm {
    height: 0.875rem;
    width: 75%;
}

/* üéØ Touch-friendly improvements */
@media (hover: none) and (pointer: coarse) {
    .mobile-nav-item {
        min-height: 44px;
    }
    
    .mobile-nav-item:active {
        transform: scale(0.98);
        background-color: rgba(51, 65, 85, 0.7);
    }
}

/* üåà Enhanced focus states for accessibility */
.focus-visible:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
}

/* üìä Progress bars for loading */
.progress-bar {
    width: 100%;
    height: 4px;
    background-color: rgba(71, 85, 105, 0.3);
    border-radius: 2px;
    overflow: hidden;
}

.progress-bar-fill {
    height: 100%;
    background-color: #3b82f6;
    animation: progress 2s ease-in-out infinite;
}

@keyframes progress {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
}

/* üåê Network indicator */
.network-indicator {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1000;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}

.network-indicator.online {
    background-color: rgba(34, 197, 94, 0.9);
    color: white;
}

.network-indicator.offline {
    background-color: rgba(239, 68, 68, 0.9);
    color: white;
}

/* üì± Mobile loading states */
@media (max-width: 768px) {
    .mobile-loading {
        flex-direction: column;
        padding: 1rem;
    }
    
    .mobile-loading .skeleton {
        margin-bottom: 1rem;
    }
}
</style>

<!-- üöÄ Progressive Enhancement Scripts -->
<script>
    // üì± Mobile touch improvements
    if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
    }

    // üéØ Enhanced HTMX event handling
    document.addEventListener('htmx:afterRequest', function(event) {
        console.log('‚úÖ HTMX Request completed:', event.detail);
    });

    document.addEventListener('htmx:beforeRequest', function(event) {
        console.log('üîÑ HTMX Request started:', event.detail);
    });
</script>
{% endblock %}