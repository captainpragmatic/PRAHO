{% extends "base.html" %}
{% load i18n %}
{% load ui_components %}

{% block title %}{% trans "Pricing" %}: {{ product.name }} - PRAHO Platform{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex justify-between items-start mb-6">
    <div>
      <div class="flex items-center space-x-2 text-sm text-slate-400 mb-2">
        <a href="{% url 'products:product_list' %}" class="hover:text-blue-400">{% trans 'Products' %}</a>
        <span>‚Ä¢</span>
        <a href="{% url 'products:product_detail' slug=product.slug %}" class="hover:text-blue-400">{{ product.name }}</a>
        <span>‚Ä¢</span>
        <span>{% trans 'Pricing' %}</span>
      </div>
      <h1 class="text-3xl font-bold text-white">
        üí∞ {% trans "Pricing Management" %}
      </h1>
      <p class="mt-2 text-slate-400">{{ product.name }} - {% trans "Manage multi-currency pricing for Romanian business" %}</p>
    </div>
    
    <div class="flex space-x-3">
      {% url 'products:product_detail' slug=product.slug as detail_url %}
      {% button "‚Üê Back to Product" variant="secondary" href=detail_url %}
      {% url 'products:product_price_create' slug=product.slug as create_price_url %}
      {% button "üí∞ Add Price" variant="primary" href=create_price_url %}
    </div>
  </div>

  <!-- Romanian Business Context -->
  <div class="bg-blue-900 border border-blue-700 rounded-lg p-4 mb-6">
    <div class="flex items-start">
      <div class="flex-shrink-0">
        <span class="text-blue-300 text-xl">üá∑üá¥</span>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium text-blue-200">{% trans 'Romanian Business Pricing' %}</h3>
        <div class="mt-1 text-sm text-blue-300">
          <p>{% trans 'RON (Romanian Lei) pricing is prioritized for local business. VAT inclusion setting:' %}
            {% if product.includes_vat %}
              <span class="text-green-300 font-medium">{% trans 'Prices include 19% VAT' %}</span>
            {% else %}
              <span class="text-yellow-300 font-medium">{% trans 'Prices exclude VAT' %}</span>
            {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>

  {% if prices %}
  <!-- Pricing Tables by Currency -->
  {% regroup prices by currency as currency_groups %}
  
  <div class="space-y-8">
    {% for currency_group in currency_groups %}
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <!-- Currency Header -->
      <div class="px-6 py-4 border-b border-slate-700 flex items-center justify-between">
        <div class="flex items-center">
          <h2 class="text-xl font-semibold text-white flex items-center">
            <span class="mr-3">üí±</span>
            {{ currency_group.grouper.name }} ({{ currency_group.grouper.code }})
            {% if currency_group.grouper.code == 'RON' %}
              <span class="ml-3 px-2 py-1 bg-green-800 text-green-200 text-xs rounded">{% trans 'Romanian Lei' %}</span>
            {% endif %}
          </h2>
          <span class="ml-4 text-slate-400">{{ currency_group.grouper.symbol }}</span>
        </div>
        
        <div class="flex items-center space-x-2">
          {% if currency_group.grouper.is_active %}
            {% badge "Active Currency" variant="success" %}
          {% else %}
            {% badge "Inactive Currency" variant="danger" %}
          {% endif %}
        </div>
      </div>

      <!-- Pricing Grid -->
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
          {% for price in currency_group.list %}
          <div class="bg-slate-700 rounded-lg border border-slate-600 p-4 hover:bg-slate-650 transition-colors">
            <!-- Price Header -->
            <div class="flex items-center justify-between mb-3">
              <div class="text-sm font-medium text-slate-300">
                {{ price.get_billing_period_display }}
              </div>
              {% if price.is_active %}
                {% badge "Active" variant="success" size="sm" %}
              {% else %}
                {% badge "Inactive" variant="danger" size="sm" %}
              {% endif %}
            </div>

            <!-- Main Price -->
            <div class="mb-3">
              <div class="text-2xl font-bold text-white">
                {{ price.effective_price|floatformat:2 }} {{ currency_group.grouper.symbol }}
              </div>
              
              <!-- Promotional Price Indicator -->
              {% if price.promo_price_cents and price.promo_valid_until %}
                <div class="text-sm text-red-400 line-through">
                  {{ price.amount|floatformat:2 }} {{ currency_group.grouper.symbol }}
                </div>
                <div class="text-xs text-yellow-400">
                  {% trans 'Promo until' %} {{ price.promo_valid_until|date:"j M Y" }}
                </div>
              {% endif %}
            </div>

            <!-- Setup Fee -->
            {% if price.setup_cents > 0 %}
            <div class="text-sm text-slate-400 mb-3">
              + {{ price.setup_fee|floatformat:2 }} {{ currency_group.grouper.symbol }} {% trans 'setup fee' %}
            </div>
            {% endif %}

            <!-- Additional Details -->
            <div class="space-y-1 text-xs text-slate-500">
              {% if price.minimum_quantity > 1 %}
                <div>{% trans 'Min qty:' %} {{ price.minimum_quantity }}</div>
              {% endif %}
              
              {% if price.maximum_quantity %}
                <div>{% trans 'Max qty:' %} {{ price.maximum_quantity }}</div>
              {% endif %}
              
              {% if price.discount_percent > 0 %}
                <div class="text-green-400">{{ price.discount_percent }}% {% trans 'discount' %}</div>
              {% endif %}
            </div>

            <!-- Price Actions -->
            <div class="mt-4 pt-3 border-t border-slate-600 flex justify-end space-x-2">
              <button class="text-yellow-400 hover:text-yellow-300 text-sm" 
                      title="{% trans 'Edit Price' %}">
                ‚úèÔ∏è
              </button>
              <button class="text-red-400 hover:text-red-300 text-sm" 
                      title="{% trans 'Delete Price' %}"
                      hx-delete="#"
                      hx-confirm="{% trans 'Are you sure you want to delete this price?' %}">
                üóëÔ∏è
              </button>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% else %}
  <!-- Empty State -->
  <div class="bg-slate-800 rounded-lg border border-slate-700">
    <div class="text-center py-12">
      <div class="text-6xl mb-4">üí∞</div>
      <h3 class="text-lg font-medium text-slate-300 mb-2">
        {% trans 'No pricing configured' %}
      </h3>
      <p class="text-slate-400 mb-6">
        {% trans 'Start by adding pricing options for this product. Multiple currencies and billing periods are supported.' %}
      </p>
      {% url 'products:product_price_create' slug=product.slug as create_price_url %}
      {% button "üí∞ Add First Price" variant="primary" href=create_price_url %}
    </div>
  </div>
  {% endif %}

  <!-- Pricing Guidelines -->
  <div class="mt-8 bg-slate-800 rounded-lg border border-slate-700 p-6">
    <h3 class="text-lg font-semibold text-white mb-4">üìã {% trans 'Pricing Guidelines' %}</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-slate-400">
      <div>
        <h4 class="font-medium text-slate-300 mb-2">{% trans 'Romanian Business' %}</h4>
        <ul class="space-y-1 list-disc list-inside">
          <li>{% trans 'RON pricing is recommended for local customers' %}</li>
          <li>{% trans 'Set VAT inclusion correctly for tax compliance' %}</li>
          <li>{% trans 'Consider e-Factura integration requirements' %}</li>
        </ul>
      </div>
      <div>
        <h4 class="font-medium text-slate-300 mb-2">{% trans 'Best Practices' %}</h4>
        <ul class="space-y-1 list-disc list-inside">
          <li>{% trans 'Offer multiple billing periods (monthly, annual)' %}</li>
          <li>{% trans 'Use promotional pricing for special offers' %}</li>
          <li>{% trans 'Set appropriate minimum/maximum quantities' %}</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}