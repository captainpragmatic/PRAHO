# =============================================================================
# PRAHO - Two Server Inventory
# =============================================================================
# Platform + DB on primary server, Portal on secondary server

all:
  children:
    primary:
      hosts:
        platform-server:
          ansible_host: "{{ lookup('env', 'PRAHO_PLATFORM_IP') | default('platform-server-ip', true) }}"
          ansible_user: "{{ lookup('env', 'PRAHO_SSH_USER') | default('root', true) }}"
          ansible_ssh_private_key_file: "{{ lookup('env', 'PRAHO_SSH_KEY') | default('~/.ssh/id_rsa', true) }}"
      vars:
        deploy_platform: true
        deploy_portal: false
        deploy_database: true
        deploy_caddy: true
        is_primary: true

    secondary:
      hosts:
        portal-server:
          ansible_host: "{{ lookup('env', 'PRAHO_PORTAL_IP') | default('portal-server-ip', true) }}"
          ansible_user: "{{ lookup('env', 'PRAHO_SSH_USER') | default('root', true) }}"
          ansible_ssh_private_key_file: "{{ lookup('env', 'PRAHO_SSH_KEY') | default('~/.ssh/id_rsa', true) }}"
      vars:
        deploy_platform: false
        deploy_portal: true
        deploy_database: false
        deploy_caddy: true
        is_primary: false
        platform_api_url: "https://{{ hostvars['platform-server']['domain'] }}/api"
