# Generated by Django 5.2.5 on 2025-09-13 15:07

import django.core.validators
import django.utils.timezone
import uuid
from decimal import Decimal
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='CreditLedger',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('delta_cents', models.BigIntegerField()),
                ('reason', models.CharField(max_length=255)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Credit Entry',
                'verbose_name_plural': 'Credit Entries',
                'db_table': 'credit_ledger',
            },
        ),
        migrations.CreateModel(
            name='Currency',
            fields=[
                ('code', models.CharField(max_length=3, primary_key=True, serialize=False)),
                ('name', models.CharField(default='', max_length=50)),
                ('symbol', models.CharField(max_length=10)),
                ('decimals', models.SmallIntegerField(default=2)),
            ],
            options={
                'verbose_name': 'Currency',
                'verbose_name_plural': 'Currencies',
                'db_table': 'currency',
            },
        ),
        migrations.CreateModel(
            name='FXRate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rate', models.DecimalField(decimal_places=8, max_digits=18)),
                ('as_of', models.DateField()),
            ],
            options={
                'db_table': 'fx_rate',
            },
        ),
        migrations.CreateModel(
            name='Invoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('number', models.CharField(default='TMP-000', max_length=50, unique=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('issued', 'Issued'), ('paid', 'Paid'), ('overdue', 'Overdue'), ('void', 'Void'), ('refunded', 'Refunded')], default='draft', max_length=20)),
                ('exchange_to_ron', models.DecimalField(blank=True, decimal_places=6, help_text='Exchange rate to RON at time of invoice', max_digits=18, null=True)),
                ('subtotal_cents', models.BigIntegerField(default=0)),
                ('tax_cents', models.BigIntegerField(default=0)),
                ('total_cents', models.BigIntegerField(default=0)),
                ('issued_at', models.DateTimeField(blank=True, null=True)),
                ('due_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('locked_at', models.DateTimeField(blank=True, help_text='When invoice became immutable', null=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('paid_at', models.DateTimeField(blank=True, null=True)),
                ('meta', models.JSONField(blank=True, default=dict)),
                ('bill_to_name', models.CharField(default='', max_length=255)),
                ('bill_to_tax_id', models.CharField(blank=True, max_length=50)),
                ('bill_to_email', models.EmailField(blank=True, max_length=254)),
                ('bill_to_address1', models.CharField(blank=True, max_length=255)),
                ('bill_to_address2', models.CharField(blank=True, max_length=255)),
                ('bill_to_city', models.CharField(blank=True, max_length=100)),
                ('bill_to_region', models.CharField(blank=True, max_length=100)),
                ('bill_to_postal', models.CharField(blank=True, max_length=20)),
                ('bill_to_country', models.CharField(blank=True, max_length=2)),
                ('efactura_id', models.CharField(blank=True, max_length=100)),
                ('efactura_sent', models.BooleanField(default=False)),
                ('efactura_sent_date', models.DateTimeField(blank=True, null=True)),
                ('efactura_response', models.JSONField(blank=True, default=dict)),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='invoices/pdf/')),
                ('xml_file', models.FileField(blank=True, null=True, upload_to='invoices/xml/')),
            ],
            options={
                'verbose_name': 'Invoice',
                'verbose_name_plural': 'Invoices',
                'db_table': 'invoice',
            },
        ),
        migrations.CreateModel(
            name='InvoiceLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('kind', models.CharField(choices=[('service', 'Service'), ('setup', 'Setup Fee'), ('credit', 'Credit'), ('discount', 'Discount'), ('refund', 'Refund'), ('misc', 'Miscellaneous')], max_length=20)),
                ('description', models.CharField(max_length=500)),
                ('quantity', models.DecimalField(decimal_places=3, default=Decimal('1.000'), max_digits=12)),
                ('unit_price_cents', models.BigIntegerField(default=0)),
                ('tax_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), help_text='Tax rate as decimal (0.19 for 19%)', max_digits=5)),
                ('tax_cents', models.BigIntegerField(default=0, help_text='Tax amount in cents')),
                ('line_total_cents', models.BigIntegerField(default=0)),
            ],
            options={
                'verbose_name': 'Invoice Line',
                'verbose_name_plural': 'Invoice Lines',
                'db_table': 'invoice_line',
            },
        ),
        migrations.CreateModel(
            name='InvoiceSequence',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scope', models.CharField(default='default', max_length=50, unique=True)),
                ('last_value', models.BigIntegerField(default=0)),
            ],
            options={
                'verbose_name': 'Invoice Sequence',
                'verbose_name_plural': 'Invoice Sequences',
                'db_table': 'invoice_sequence',
            },
        ),
        migrations.CreateModel(
            name='Payment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('succeeded', 'Succeeded'), ('failed', 'Failed'), ('refunded', 'Refunded'), ('partially_refunded', 'Partially Refunded')], default='pending', max_length=20)),
                ('payment_method', models.CharField(choices=[('stripe', 'Stripe'), ('bank', 'Bank Transfer'), ('paypal', 'PayPal'), ('cash', 'Cash'), ('other', 'Other')], default='stripe', max_length=20)),
                ('amount_cents', models.BigIntegerField(default=0, validators=[django.core.validators.MinValueValidator(1)])),
                ('gateway_txn_id', models.CharField(blank=True, max_length=255)),
                ('reference_number', models.CharField(blank=True, max_length=100)),
                ('received_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('meta', models.JSONField(blank=True, default=dict)),
                ('notes', models.TextField(blank=True)),
            ],
            options={
                'verbose_name': 'Payment',
                'verbose_name_plural': 'Payments',
                'db_table': 'payment',
            },
        ),
        migrations.CreateModel(
            name='PaymentCollectionRun',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('run_type', models.CharField(choices=[('automatic', 'Automatic Scheduled'), ('manual', 'Manual Trigger'), ('test', 'Test Run')], default='automatic', max_length=20)),
                ('started_at', models.DateTimeField(auto_now_add=True)),
                ('completed_at', models.DateTimeField(blank=True, help_text='When collection run completed', null=True)),
                ('total_scheduled', models.PositiveIntegerField(default=0, help_text='Total retry attempts scheduled in this run')),
                ('total_processed', models.PositiveIntegerField(default=0, help_text='Total retry attempts processed')),
                ('total_successful', models.PositiveIntegerField(default=0, help_text='Total successful payment recoveries')),
                ('total_failed', models.PositiveIntegerField(default=0, help_text='Total failed retry attempts')),
                ('amount_recovered_cents', models.BigIntegerField(default=0, help_text='Total amount recovered in cents')),
                ('fees_charged_cents', models.BigIntegerField(default=0, help_text='Total fees charged by payment processor')),
                ('status', models.CharField(choices=[('running', 'Running'), ('completed', 'Completed'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='running', max_length=20)),
                ('error_message', models.TextField(blank=True, help_text='Error message if run failed')),
                ('config_snapshot', models.JSONField(blank=True, default=dict, help_text='Configuration used for this run')),
            ],
            options={
                'verbose_name': 'Payment Collection Run',
                'verbose_name_plural': 'Payment Collection Runs',
                'db_table': 'payment_collection_runs',
                'ordering': ('-started_at',),
            },
        ),
        migrations.CreateModel(
            name='PaymentRetryAttempt',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('attempt_number', models.PositiveIntegerField(help_text='Sequence number of this retry attempt (1, 2, 3...)')),
                ('scheduled_at', models.DateTimeField(help_text='When this retry was scheduled to run')),
                ('executed_at', models.DateTimeField(blank=True, help_text='When this retry was actually executed', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('success', 'Success'), ('failed', 'Failed'), ('skipped', 'Skipped'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('gateway_response', models.JSONField(blank=True, default=dict, help_text='Payment gateway response for audit')),
                ('failure_reason', models.TextField(blank=True, help_text='Reason for failure if retry was unsuccessful')),
                ('dunning_email_sent', models.BooleanField(default=False, help_text='Whether dunning email was sent for this attempt')),
                ('dunning_email_sent_at', models.DateTimeField(blank=True, help_text='When dunning email was sent', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Payment Retry Attempt',
                'verbose_name_plural': 'Payment Retry Attempts',
                'db_table': 'payment_retry_attempts',
                'ordering': ('payment', 'attempt_number'),
            },
        ),
        migrations.CreateModel(
            name='PaymentRetryPolicy',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text="Human-readable policy name (e.g., 'Standard Hosting', 'VIP Customer')", max_length=100, unique=True)),
                ('description', models.TextField(blank=True, help_text='Description of when this policy applies')),
                ('retry_intervals_days', models.JSONField(default=list, help_text='Days after failure to retry (e.g., [1, 3, 7, 14, 30])')),
                ('max_attempts', models.IntegerField(default=4, help_text='Maximum number of retry attempts', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)])),
                ('suspend_service_after_days', models.IntegerField(blank=True, help_text='Days after final failure to suspend service (null = never)', null=True)),
                ('terminate_service_after_days', models.IntegerField(blank=True, help_text='Days after final failure to terminate service (null = never)', null=True)),
                ('send_dunning_emails', models.BooleanField(default=True, help_text='Whether to send email notifications during dunning')),
                ('email_template_prefix', models.CharField(default='dunning', help_text="Template prefix for dunning emails (e.g., 'dunning_vip')", max_length=50)),
                ('is_default', models.BooleanField(default=False, help_text='Whether this is the default policy for new customers')),
                ('is_active', models.BooleanField(default=True, help_text='Whether this policy is currently active')),
                ('meta', models.JSONField(blank=True, default=dict, help_text='Additional policy configuration')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Payment Retry Policy',
                'verbose_name_plural': 'Payment Retry Policies',
                'db_table': 'payment_retry_policies',
                'ordering': ('name',),
            },
        ),
        migrations.CreateModel(
            name='ProformaInvoice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('number', models.CharField(default='PRO-000', max_length=50, unique=True)),
                ('subtotal_cents', models.BigIntegerField(default=0)),
                ('tax_cents', models.BigIntegerField(default=0)),
                ('total_cents', models.BigIntegerField(default=0)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('sent', 'Sent'), ('accepted', 'Accepted'), ('expired', 'Expired')], default='draft', max_length=20)),
                ('valid_until', models.DateTimeField(default=django.utils.timezone.now, help_text='Proforma expires after this date')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('meta', models.JSONField(blank=True, default=dict)),
                ('notes', models.TextField(blank=True, help_text='Additional notes for the proforma')),
                ('bill_to_name', models.CharField(default='', max_length=255)),
                ('bill_to_tax_id', models.CharField(blank=True, max_length=50)),
                ('bill_to_email', models.EmailField(blank=True, max_length=254)),
                ('bill_to_address1', models.CharField(blank=True, max_length=255)),
                ('bill_to_address2', models.CharField(blank=True, max_length=255)),
                ('bill_to_city', models.CharField(blank=True, max_length=100)),
                ('bill_to_region', models.CharField(blank=True, max_length=100)),
                ('bill_to_postal', models.CharField(blank=True, max_length=20)),
                ('bill_to_country', models.CharField(blank=True, max_length=2)),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='proformas/pdf/')),
            ],
            options={
                'verbose_name': 'Proforma Invoice',
                'verbose_name_plural': 'Proforma Invoices',
                'db_table': 'proforma_invoice',
            },
        ),
        migrations.CreateModel(
            name='ProformaLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('kind', models.CharField(choices=[('service', 'Service'), ('setup', 'Setup Fee'), ('discount', 'Discount'), ('misc', 'Miscellaneous')], max_length=20)),
                ('description', models.CharField(max_length=500)),
                ('quantity', models.DecimalField(decimal_places=3, default=Decimal('1.000'), max_digits=12)),
                ('unit_price_cents', models.BigIntegerField(default=0)),
                ('tax_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5)),
                ('tax_cents', models.BigIntegerField(default=0, help_text='Tax amount in cents')),
                ('line_total_cents', models.BigIntegerField(default=0)),
            ],
            options={
                'db_table': 'proforma_line',
            },
        ),
        migrations.CreateModel(
            name='ProformaSequence',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('scope', models.CharField(default='default', max_length=50, unique=True)),
                ('last_value', models.BigIntegerField(default=0)),
            ],
            options={
                'verbose_name': 'Proforma Sequence',
                'verbose_name_plural': 'Proforma Sequences',
                'db_table': 'proforma_sequence',
            },
        ),
        migrations.CreateModel(
            name='Refund',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('approved', 'Approved'), ('completed', 'Completed'), ('rejected', 'Rejected'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('refund_type', models.CharField(choices=[('full', 'Full Refund'), ('partial', 'Partial Refund')], default='full', max_length=20)),
                ('reason', models.CharField(choices=[('customer_request', 'Customer Request'), ('error_correction', 'Error Correction'), ('dispute', 'Dispute'), ('service_failure', 'Service Failure'), ('duplicate_payment', 'Duplicate Payment'), ('fraud', 'Fraud'), ('cancellation', 'Cancellation'), ('downgrade', 'Downgrade'), ('administrative', 'Administrative')], default='customer_request', max_length=50)),
                ('amount_cents', models.BigIntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('original_amount_cents', models.BigIntegerField(help_text='Original transaction amount for reference')),
                ('gateway_refund_id', models.CharField(blank=True, help_text='Payment gateway refund ID', max_length=255)),
                ('reference_number', models.CharField(help_text='Unique refund reference number', max_length=100, unique=True)),
                ('reason_description', models.TextField(blank=True, help_text='Detailed reason for refund')),
                ('internal_notes', models.TextField(blank=True, help_text='Internal notes not visible to customer')),
                ('processed_at', models.DateTimeField(blank=True, help_text='When refund was actually processed', null=True)),
                ('gateway_processed_at', models.DateTimeField(blank=True, help_text='When gateway confirmed processing', null=True)),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional refund metadata')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Refund',
                'verbose_name_plural': 'Refunds',
                'db_table': 'refunds',
            },
        ),
        migrations.CreateModel(
            name='RefundNote',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('note_type', models.CharField(choices=[('internal', 'Internal Note'), ('customer', 'Customer Communication'), ('gateway', 'Gateway Response'), ('system', 'System Generated')], default='internal', max_length=20)),
                ('title', models.CharField(blank=True, help_text='Optional note title', max_length=200)),
                ('content', models.TextField(help_text='Note content')),
                ('is_customer_visible', models.BooleanField(default=False, help_text='Whether customer can see this note')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional note metadata')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Refund Note',
                'verbose_name_plural': 'Refund Notes',
                'db_table': 'refund_notes',
                'ordering': ('-created_at',),
            },
        ),
        migrations.CreateModel(
            name='RefundStatusHistory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('previous_status', models.CharField(blank=True, choices=[('pending', 'Pending'), ('processing', 'Processing'), ('approved', 'Approved'), ('completed', 'Completed'), ('rejected', 'Rejected'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='', max_length=20)),
                ('new_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('approved', 'Approved'), ('completed', 'Completed'), ('rejected', 'Rejected'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], max_length=20)),
                ('change_reason', models.TextField(blank=True, help_text='Reason for status change')),
                ('metadata', models.JSONField(blank=True, default=dict, help_text='Additional status change metadata')),
                ('changed_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Refund Status History',
                'verbose_name_plural': 'Refund Status Histories',
                'db_table': 'refund_status_history',
                'ordering': ('-changed_at',),
            },
        ),
        migrations.CreateModel(
            name='TaxRule',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('country_code', models.CharField(help_text="ISO 3166-1 alpha-2 country code (e.g., 'RO', 'DE')", max_length=2)),
                ('region', models.CharField(blank=True, help_text='State/province for countries with regional tax rates', max_length=50)),
                ('tax_type', models.CharField(choices=[('vat', 'VAT'), ('gst', 'GST'), ('sales_tax', 'Sales Tax'), ('withholding', 'Withholding Tax')], default='vat', max_length=20)),
                ('rate', models.DecimalField(decimal_places=4, help_text='Tax rate as decimal (e.g., 0.19 for 19%)', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('reduced_rate', models.DecimalField(blank=True, decimal_places=4, help_text='Reduced rate for specific product categories', max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1)])),
                ('valid_from', models.DateField(help_text='When this tax rate becomes effective')),
                ('valid_to', models.DateField(blank=True, help_text='When this tax rate expires (null = indefinite)', null=True)),
                ('applies_to_b2b', models.BooleanField(default=True, help_text='Whether tax applies to business-to-business transactions')),
                ('applies_to_b2c', models.BooleanField(default=True, help_text='Whether tax applies to business-to-consumer transactions')),
                ('reverse_charge_eligible', models.BooleanField(default=False, help_text='Whether reverse charge mechanism applies (EU B2B)')),
                ('is_eu_member', models.BooleanField(default=False, help_text='Whether country is EU member for VAT purposes')),
                ('vies_required', models.BooleanField(default=False, help_text='Whether VIES VAT number validation is required')),
                ('meta', models.JSONField(blank=True, default=dict, help_text='Additional tax configuration and rules')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Tax Rule',
                'verbose_name_plural': 'Tax Rules',
                'db_table': 'tax_rules',
                'ordering': ('country_code', 'tax_type', '-valid_from'),
            },
        ),
        migrations.CreateModel(
            name='VATValidation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('country_code', models.CharField(help_text="Country code (e.g., 'RO')", max_length=2)),
                ('vat_number', models.CharField(help_text='VAT number without country prefix', max_length=20)),
                ('full_vat_number', models.CharField(help_text="Complete VAT number (e.g., 'RO12345678')", max_length=25)),
                ('is_valid', models.BooleanField(help_text='Whether VAT number is valid')),
                ('is_active', models.BooleanField(default=False, help_text='Whether company is active for VAT purposes')),
                ('company_name', models.CharField(blank=True, help_text='Company name from VIES (if available)', max_length=255)),
                ('company_address', models.TextField(blank=True, help_text='Company address from VIES (if available)')),
                ('validation_date', models.DateTimeField(auto_now_add=True)),
                ('validation_source', models.CharField(choices=[('vies', 'VIES API'), ('manual', 'Manual Override'), ('cached', 'Previous Validation')], default='vies', max_length=20)),
                ('response_data', models.JSONField(blank=True, default=dict, help_text='Raw API response for audit purposes')),
                ('expires_at', models.DateTimeField(blank=True, help_text='When validation result expires', null=True)),
            ],
            options={
                'verbose_name': 'VAT Validation',
                'verbose_name_plural': 'VAT Validations',
                'db_table': 'vat_validations',
                'ordering': ('-validation_date',),
            },
        ),
    ]
