{% extends 'base.html' %}
{% load ui_components %}
{% load formatting %}
{% load i18n %}

{% block title %}üîÑ Renew {{ domain.name }} - PRAHO{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Breadcrumb -->
    <nav class="flex mb-6" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{% url 'domains:list' %}" class="inline-flex items-center text-sm font-medium text-slate-700 hover:text-primary-600 dark:text-slate-400 dark:hover:text-white">
                    üåç {% trans "Domains" %}
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <span class="mx-2 text-slate-400">/</span>
                    <a href="{% url 'domains:detail' domain.id %}" class="text-sm font-medium text-slate-700 hover:text-primary-600 dark:text-slate-400 dark:hover:text-white">
                        {{ domain.name }}
                    </a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <span class="mx-2 text-slate-400">/</span>
                    <span class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Renew" %}</span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-slate-900 dark:text-white">üîÑ {% trans "Renew Domain" %}</h1>
        <p class="mt-2 text-lg text-slate-600 dark:text-slate-300 font-mono">{{ domain.name }}</p>
    </div>

    <!-- Expiry Alert -->
    {% if days_until_expiry is not None %}
        <div class="mb-6">
            {% if days_until_expiry < 0 %}
                {% alert "‚ö†Ô∏è This domain has already expired! Renew immediately to avoid losing it." variant="danger" dismissible=False %}
            {% elif days_until_expiry <= 7 %}
                {% alert "üö® This domain expires in "|add:days_until_expiry|add:" days! Renew now to avoid service interruption." variant="danger" dismissible=False %}
            {% elif days_until_expiry <= 30 %}
                {% alert "‚ö†Ô∏è This domain expires in "|add:days_until_expiry|add:" days. Consider renewing now." variant="warning" dismissible=False %}
            {% else %}
                {% alert "‚ÑπÔ∏è This domain expires in "|add:days_until_expiry|add:" days." variant="info" dismissible=False %}
            {% endif %}
        </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Domain Information -->
        <div class="lg:col-span-2">
            <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 mb-6">
                <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">üìã {% trans "Domain Information" %}</h2>

                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Domain" %}</dt>
                        <dd class="mt-1 text-sm text-slate-900 dark:text-white font-mono">{{ domain.name }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Status" %}</dt>
                        <dd class="mt-1">{% badge domain.get_status_display %}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Current Expiry" %}</dt>
                        <dd class="mt-1 text-sm text-slate-900 dark:text-white">
                            {{ domain.expires_at|romanian_date:"long" }}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Registrar" %}</dt>
                        <dd class="mt-1 text-sm text-slate-900 dark:text-white">{{ domain.registrar.display_name }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "Auto-Renewal" %}</dt>
                        <dd class="mt-1">
                            {% if domain.auto_renew %}
                                <span class="text-green-600 dark:text-green-400">‚úÖ {% trans "Enabled" %}</span>
                            {% else %}
                                <span class="text-slate-500 dark:text-slate-400">‚ùå {% trans "Disabled" %}</span>
                            {% endif %}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-slate-500 dark:text-slate-400">{% trans "WHOIS Privacy" %}</dt>
                        <dd class="mt-1">
                            {% if domain.whois_privacy %}
                                <span class="text-green-600 dark:text-green-400">üîí {% trans "Protected" %}</span>
                            {% else %}
                                <span class="text-slate-500 dark:text-slate-400">{% trans "Public" %}</span>
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>

            <!-- Renewal Options -->
            <div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6">
                <h2 class="text-xl font-semibold text-slate-900 dark:text-white mb-4">üí∞ {% trans "Renewal Options" %}</h2>

                {# nosemgrep: django-no-csrf-token ‚Äî csrf_token present on adjacent line #}
                <form method="post" id="renewal-form">
                    {% csrf_token %}

                    <!-- Renewal Period Selection -->
                    <div class="space-y-4">
                        {% for option in renewal_costs %}
                            <label class="relative block cursor-pointer">
                                <input
                                    type="radio"
                                    name="years"
                                    value="{{ option.years }}"
                                    {% if option.years == 1 %}checked{% endif %}
                                    class="sr-only peer"
                                {# nosemgrep: no-interpolation-js-template-string ‚Äî safe numeric template variable #}
                                >\n                                <div class="border-2 border-slate-200 dark:border-slate-700 rounded-lg p-4 transition-all peer-checked:border-primary-500 peer-checked:bg-primary-50 dark:peer-checked:bg-primary-900/20 hover:border-slate-300 dark:hover:border-slate-600">\n                                    <div class=\"flex items-center justify-between\">\n                                        <div>\n                                            <p class=\"text-lg font-semibold text-slate-900 dark:text-white\">\n                                                {{ option.years }} {% trans \"year\" %}{{ option.years|pluralize }}\n                                            </p>\n                                            <p class=\"text-sm text-slate-500 dark:text-slate-400\">\n                                                {% trans \"New expiry:\" %}\n                                                {% with new_expiry=domain.expires_at|add_years:option.years %}\n                                                    {{ new_expiry|romanian_date:\"long\" }}\n                                                {% endwith %}\n                                            </p>\n                                        </div>\n                                        <div class=\"text-right\">\n                                            <p class=\"text-xl font-bold text-slate-900 dark:text-white\">\n                                                {{ option.cost_cents|cents_to_currency|romanian_currency }}\n                                            </p>\n                                            {% if option.years > 1 %}\n                                                <p class=\"text-sm text-slate-500 dark:text-slate-400\">\n                                                    {{ option.cost|divide:option.years|floatformat:2 }} RON/{% trans \"year\" %}\n                                                </p>\n                                            {% endif %}\n                                        </div>\n                                    </div>\n                                    \n                                    <!-- Selected indicator -->\n                                    <div class=\"absolute top-4 right-4 h-4 w-4 rounded-full border-2 border-slate-300 dark:border-slate-600 peer-checked:border-primary-500 peer-checked:bg-primary-500\">\n                                        <div class=\"hidden peer-checked:block absolute inset-0.5 rounded-full bg-white\"></div>\n                                    </div>\n                                </div>\n                            </label>\n                        {% endfor %}\n                    </div>\n\n                    <!-- Renewal Summary -->\n                    <div class=\"mt-6 p-4 bg-slate-50 dark:bg-slate-700 rounded-lg\">\n                        <h3 class=\"text-lg font-medium text-slate-900 dark:text-white mb-2\">üìã {% trans \"Renewal Summary\" %}</h3>\n                        <div id=\"renewal-summary\">\n                            <!-- Will be populated by JavaScript -->\n                        </div>\n                    </div>\n\n                    <!-- Submit Button -->\n                    <div class=\"mt-6\">\n                        {% button \"üîÑ Renew Domain\" type=\"submit\" variant=\"primary\" size=\"lg\" class=\"w-full\" %}\n                    </div>\n                </form>\n            </div>\n        </div>\n\n        <!-- Sidebar -->\n        <div>\n            <!-- Important Notes -->\n            <div class=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 mb-6\">\n                <h3 class=\"text-lg font-semibold text-slate-900 dark:text-white mb-4\">‚ÑπÔ∏è {% trans \"Important Notes\" %}</h3>\n                \n                <ul class=\"space-y-3 text-sm text-slate-600 dark:text-slate-300\">\n                    <li class=\"flex items-start\">\n                        <span class=\"text-green-500 mr-2 mt-0.5\">‚úÖ</span>\n                        <span>{% trans \"Renewal extends your current expiry date\" %}</span>\n                    </li>\n                    <li class=\"flex items-start\">\n                        <span class=\"text-blue-500 mr-2 mt-0.5\">‚ÑπÔ∏è</span>\n                        <span>{% trans \"Domain remains active during renewal process\" %}</span>\n                    </li>\n                    <li class=\"flex items-start\">\n                        <span class=\"text-orange-500 mr-2 mt-0.5\">‚ö°</span>\n                        <span>{% trans \"Renewal may take up to 24 hours to process\" %}</span>\n                    </li>\n                    <li class=\"flex items-start\">\n                        <span class=\"text-purple-500 mr-2 mt-0.5\">üí∞</span>\n                        <span>{% trans \"Longer renewals offer better per-year pricing\" %}</span>\n                    </li>\n                </ul>\n            </div>\n\n            <!-- Customer Information -->\n            <div class=\"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6\">\n                <h3 class=\"text-lg font-semibold text-slate-900 dark:text-white mb-4\">üë§ {% trans \"Domain Owner\" %}</h3>\n                \n                <div class=\"flex items-start\">\n                    <div class=\"flex-shrink-0 h-10 w-10\">\n                        <div class=\"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center\">\n                            <span class=\"text-primary-600 dark:text-primary-400 font-medium text-sm\">\n                                {{ domain.customer.first_name|slice:\":1\" }}{{ domain.customer.last_name|slice:\":1\" }}\n                            </span>\n                        </div>\n                    </div>\n                    <div class=\"ml-3\">\n                        <p class=\"text-sm font-medium text-slate-900 dark:text-white\">\n                            {{ domain.customer.get_display_name }}\n                        </p>\n                        {% if domain.customer.company_name %}\n                            <p class=\"text-sm text-slate-500 dark:text-slate-400\">{{ domain.customer.name }}</p>\n                        {% endif %}\n                        <p class=\"text-sm text-slate-500 dark:text-slate-400\">{{ domain.customer.primary_email }}</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n{% endblock %}\n\n{% block extra_js %}\n<script>\ndocument.addEventListener('DOMContentLoaded', function() {\n    const form = document.getElementById('renewal-form');\n    const summaryDiv = document.getElementById('renewal-summary');\n    \n    // Renewal costs data from Django\n    const renewalCosts = {\n        {% for option in renewal_costs %}\n            {{ option.years }}: {\n                cost: {{ option.cost }},\n                costCents: {{ option.cost_cents }}\n            }{% if not forloop.last %},{% endif %}\n        {% endfor %}\n    };\n    \n    // Update summary when selection changes\n    function updateSummary() {\n        const selectedYears = form.querySelector('input[name=\"years\"]:checked').value;\n        const cost = renewalCosts[selectedYears];\n        \n        const currentExpiry = new Date('{{ domain.expires_at|date:\"Y-m-d\" }}');\n        const newExpiry = new Date(currentExpiry);\n        newExpiry.setFullYear(newExpiry.getFullYear() + parseInt(selectedYears));\n        \n        summaryDiv.innerHTML = `\n            <div class=\"space-y-2\">\n                <div class=\"flex justify-between text-sm\">\n                    <span class=\"text-slate-600 dark:text-slate-300\">{% trans \"Domain:\" %}</span>\n                    <span class=\"font-mono text-slate-900 dark:text-white\">{{ domain.name|escapejs }}</span>\n                </div>\n                <div class=\"flex justify-between text-sm\">\n                    <span class=\"text-slate-600 dark:text-slate-300\">{% trans \"Renewal period:\" %}</span>\n                    <span class=\"text-slate-900 dark:text-white\">${selectedYears} {% trans \"year\" %}${selectedYears > 1 ? 's' : ''}</span>\n                </div>\n                <div class=\"flex justify-between text-sm\">\n                    <span class=\"text-slate-600 dark:text-slate-300\">{% trans \"Current expiry:\" %}</span>\n                    <span class=\"text-slate-900 dark:text-white\">{{ domain.expires_at|date:\"d M Y\" }}</span>\n                </div>\n                <div class=\"flex justify-between text-sm\">\n                    <span class=\"text-slate-600 dark:text-slate-300\">{% trans \"New expiry:\" %}</span>\n                    <span class=\"text-slate-900 dark:text-white\">${newExpiry.toLocaleDateString('ro-RO', {day: 'numeric', month: 'short', year: 'numeric'})}</span>\n                </div>\n                <div class=\"border-t border-slate-200 dark:border-slate-600 pt-2 mt-2\">\n                    <div class=\"flex justify-between font-semibold\">\n                        <span class=\"text-slate-900 dark:text-white\">{% trans \"Total cost:\" %}</span>\n                        <span class=\"text-slate-900 dark:text-white\">${cost.cost.toFixed(2)} RON</span>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n    \n    // Initialize summary\n    updateSummary();\n    \n    // Update summary when radio button changes\n    form.querySelectorAll('input[name=\"years\"]').forEach(radio => {\n        radio.addEventListener('change', updateSummary);\n    });\n});\n</script>\n{% endblock %}"
