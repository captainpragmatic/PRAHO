{% load i18n %}
{% load ui_components %}

{% if tickets %}
<!-- Desktop Table View (hidden on mobile) -->
<div class="hidden md:block bg-slate-800/50 border border-slate-700 rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-700">
      <thead class="bg-slate-800">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Ticket' %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Subject' %}
          </th>
          {% if user.is_staff %}
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Customer' %}
          </th>
          {% endif %}
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Status' %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Created' %}
          </th>
        </tr>
      </thead>
      <tbody class="bg-slate-800/30 divide-y divide-slate-700">
        {% for ticket in tickets %}
        <tr class="hover:bg-slate-700/50 transition-colors cursor-pointer" onclick="window.location.href='{% url 'tickets:detail' ticket.pk %}';">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center">
                  <span class="text-sm font-medium text-primary">
                    {% if ticket.ticket_number %}
                    {{ ticket.ticket_number|slice:":2" }}
                    {% else %}
                    #{{ ticket.id }}
                    {% endif %}
                  </span>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-white">
                  {% if ticket.ticket_number %}
                  {{ ticket.ticket_number }}
                  {% else %}
                  #{{ ticket.id }}
                  {% endif %}
                </div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="text-sm text-slate-400 max-w-xs">
              {% if ticket.title %}{{ ticket.title }}{% elif ticket.subject %}{{ ticket.subject }}{% else %}{{ ticket.description|truncatechars:50 }}{% endif %}
            </div>
          </td>
          {% if user.is_staff %}
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-white">{{ ticket.customer.name }}</div>
            {% if ticket.contact_email %}
            <div class="text-sm text-slate-400">{{ ticket.contact_email }}</div>
            {% endif %}
          </td>
          {% endif %}
          <td class="px-6 py-4 whitespace-nowrap">
            {% if ticket.status == 'new' %}
              {% badge "New" variant="success" icon="ğŸ†•" %}
            {% elif ticket.status == 'open' %}
              {% badge "Open" variant="info" icon="ğŸ“‚" %}
            {% elif ticket.status == 'pending' %}
              {% badge "Pending" variant="warning" icon="â³" %}
            {% elif ticket.status == 'resolved' %}
              {% badge "Resolved" variant="primary" icon="âœ…" %}
            {% elif ticket.status == 'closed' %}
              {% badge "Closed" variant="secondary" icon="ğŸ“" %}
            {% elif ticket.status == 'cancelled' %}
              {% badge "Cancelled" variant="danger" icon="âŒ" %}
            {% else %}
              {% badge ticket.status|capfirst variant="default" %}
            {% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-400">
            {{ ticket.created_at|date:"j M Y" }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Mobile Card List (visible on mobile only) -->
<div class="sm:hidden divide-y divide-slate-700">
  {% for ticket in tickets %}
  <div class="min-h-[72px] flex flex-col justify-center p-4 hover:bg-slate-700 transition-colors cursor-pointer" onclick="window.location.href='{% url 'tickets:detail' ticket.pk %}';">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center space-x-2">
        <span class="text-white font-medium text-sm font-mono truncate">
          {% if ticket.ticket_number %}
          #{{ ticket.ticket_number }}
          {% else %}
          #{{ ticket.id }}
          {% endif %}
        </span>
      </div>
      <div class="text-right">
        {% if ticket.status == 'new' %}
          {% badge "New" variant="success" icon="ğŸ†•" %}
        {% elif ticket.status == 'open' %}
          {% badge "Open" variant="info" icon="ğŸ“‚" %}
        {% elif ticket.status == 'pending' %}
          {% badge "Pending" variant="warning" icon="â³" %}
        {% elif ticket.status == 'resolved' %}
          {% badge "Resolved" variant="primary" icon="âœ…" %}
        {% elif ticket.status == 'closed' %}
          {% badge "Closed" variant="secondary" icon="ğŸ“" %}
        {% elif ticket.status == 'cancelled' %}
          {% badge "Cancelled" variant="danger" icon="âŒ" %}
        {% else %}
          {% badge ticket.status|capfirst variant="default" %}
        {% endif %}
      </div>
    </div>
    <div class="mb-2">
      <p class="text-white text-sm truncate">
        {% if ticket.title %}{{ ticket.title }}{% elif ticket.subject %}{{ ticket.subject }}{% else %}{{ ticket.description|truncatechars:50 }}{% endif %}
      </p>
      {% if user.is_staff %}
      <p class="text-slate-400 text-xs mt-1">{{ ticket.customer.name }}</p>
      {% endif %}
    </div>
    <div class="flex items-center justify-between text-sm">
      <span class="text-slate-400">{{ ticket.created_at|date:"j M Y" }}</span>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Use Platform Pagination Component -->
{% if tickets %}
  {% include 'components/pagination.html' with page_obj=tickets extra_params=url_params %}
{% endif %}

{% else %}
<!-- Enhanced Empty State -->
<div class="bg-slate-800/50 border border-slate-700 rounded-lg">
  <div class="text-center py-12 px-6">
    <div class="mx-auto h-16 w-16 bg-slate-700 rounded-full flex items-center justify-center mb-4">
      <svg class="h-8 w-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-white mb-2">{% trans 'No Support Tickets Found' %}</h3>
    <p class="text-slate-400 mb-6 max-w-sm mx-auto">
      {% if search_query or status_filter %}
        {% trans 'No tickets match your current filters. Try adjusting your search criteria.' %}
      {% elif user.is_staff %}
        {% trans 'No support tickets have been created yet. Customers can create tickets when they need assistance with their services.' %}
      {% else %}
        {% trans 'You have not created any support tickets yet. Create a ticket when you need help with your services.' %}
      {% endif %}
    </p>
  </div>
</div>
{% endif %}