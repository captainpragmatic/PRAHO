{% extends "base.html" %}
{% load ui_components %}
{% load i18n %}

{% block title %}{{ page_title }} - {% trans "Virtualmin Accounts" %}{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- =============================================================================== -->
    <!-- PAGE HEADER WITH ACTIONS -->
    <!-- =============================================================================== -->

    <!-- Breadcrumb Navigation -->
    {% breadcrumb breadcrumb_items css_class="mb-6" %}

    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h1 class="text-2xl font-bold text-slate-100 mt-2">{{ page_title }}</h1>
            <p class="mt-2 text-sm text-slate-400">
                {% trans "Manage hosting accounts on this server" %}
            </p>
        </div>
        <div class="mt-4 sm:mt-0 flex items-center space-x-3">
            <button class="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500"
                    hx-post="{% url 'provisioning:virtualmin_accounts_sync' %}"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                    hx-swap="innerHTML"
                    hx-target="#accounts-container"
                    hx-indicator="#sync-indicator"
                    hx-confirm="Sync accounts from all active Virtualmin servers? This may take a few moments.">
                ðŸ”„ Refresh Accounts
            </button>
            <div id="sync-indicator" class="htmx-indicator">
                <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">
                    <svg class="animate-spin -ml-1 mr-1.5 h-3 w-3 text-blue-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Syncing...
                </span>
            </div>
            {% url 'provisioning:virtualmin_account_new' as new_account_url %}
            {% button "New Account" href=new_account_url variant="primary" %}
        </div>
    </div>

    <!-- =============================================================================== -->
    <!-- FILTERS AND SEARCH -->
    <!-- =============================================================================== -->
    <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
        <form method="get" class="flex flex-col sm:flex-row gap-4" hx-get="{{ request.path }}" hx-target="#accounts-container" hx-trigger="submit, change delay:500ms">
            <div class="flex-1">
                <input type="search" name="search" value="{{ request.GET.search }}"
                       placeholder="{% trans 'Search accounts by domain...' %}"
                       class="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div class="sm:w-48">
                <select name="status" class="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">{% trans "All Status" %}</option>
                    <option value="active" {% if request.GET.status == "active" %}selected{% endif %}>{% trans "Active" %}</option>
                    <option value="disabled" {% if request.GET.status == "disabled" %}selected{% endif %}>{% trans "Disabled" %}</option>
                    <option value="suspended" {% if request.GET.status == "suspended" %}selected{% endif %}>{% trans "Suspended" %}</option>
                </select>
            </div>
            <div class="sm:w-48">
                <select name="plan" class="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">{% trans "All Plans" %}</option>
                    {% for plan in available_plans %}
                    <option value="{{ plan.id }}" {% if request.GET.plan == plan.id|stringformat:"s" %}selected{% endif %}>{{ plan.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </form>
    </div>

    <!-- =============================================================================== -->
    <!-- ACCOUNTS CONTAINER (HTMX Target) -->
    <!-- =============================================================================== -->
    <div id="accounts-container">
        {% include "provisioning/virtualmin/partials/accounts_table.html" %}
    </div>
</div>
{% endblock %}
