{% extends "base.html" %}
{% load i18n %}
{% load settings_tags %}

{% block title %}{% trans "Cookie Policy" %} - PRAHO Platform{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">{% trans "Cookie Policy" %}</h1>
        <p class="text-slate-400">
            {% trans "Last updated" %}: {{ last_updated|date:"F j, Y" }}
        </p>
    </div>

    <!-- Cookie Preference Button -->
    <div class="bg-blue-900/30 rounded-lg p-6 mb-8 border border-blue-700">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h2 class="text-lg font-semibold text-blue-300 mb-1">{% trans "Manage Your Cookie Preferences" %}</h2>
                <p class="text-slate-300 text-sm">
                    {% trans "You can update your cookie preferences at any time." %}
                </p>
            </div>
            {# nosemgrep: template-translate-as-no-escape â€” developer-managed translation string, escaped at output #}
            {% trans "Cookie preferences panel will appear on next page load." as cookie_msg %}
            <button onclick="window.showCookiePreferences ? window.showCookiePreferences() : alert('{{ cookie_msg|escapejs }}')"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-medium transition-colors">
                {% trans "Cookie Settings" %}
            </button>
        </div>
    </div>

    <!-- Content -->
    <div class="prose prose-invert max-w-none space-y-8">

        <!-- Introduction -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "What Are Cookies?" %}</h2>
            <p class="text-slate-300 mb-4">
                {% filter force_escape %}{% blocktrans %}
                Cookies are small text files that are stored on your device (computer, tablet, or mobile)
                when you visit a website. They help websites function properly, remember your preferences,
                and provide information to website owners.
                {% endblocktrans %}{% endfilter %}
            </p>
            <p class="text-slate-300">
                {% filter force_escape %}{% blocktrans %}
                This Cookie Policy explains what cookies we use, why we use them, and how you can control them.
                This policy should be read alongside our Privacy Policy.
                {% endblocktrans %}{% endfilter %}
            </p>
        </section>

        <!-- Cookie Categories -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "Types of Cookies We Use" %}</h2>

            <!-- Essential Cookies -->
            <div class="mb-6 bg-green-900/20 rounded-lg p-4 border border-green-800">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-medium text-green-300">{% trans "Essential Cookies" %}</h3>
                    <span class="bg-green-700 text-green-100 text-xs px-2 py-1 rounded">{% trans "Always Active" %}</span>
                </div>
                <p class="text-slate-300 text-sm mb-4">
                    {% filter force_escape %}{% blocktrans %}
                    These cookies are strictly necessary for the website to function. They enable core functionality
                    such as security, session management, and accessibility. You cannot disable these cookies.
                    {% endblocktrans %}{% endfilter %}
                </p>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th class="text-left p-2 text-white">{% trans "Cookie Name" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Purpose" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Duration" %}</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-300">
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">csrftoken</td>
                                <td class="p-2">{% trans "CSRF protection for form submissions" %}</td>
                                <td class="p-2">1 {% trans "year" %}</td>
                            </tr>
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">sessionid</td>
                                <td class="p-2">{% trans "User session management" %}</td>
                                <td class="p-2">2 {% trans "weeks" %}</td>
                            </tr>
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">cookie_consent</td>
                                <td class="p-2">{% trans "Stores your cookie preferences" %}</td>
                                <td class="p-2">1 {% trans "year" %}</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-mono text-xs">django_language</td>
                                <td class="p-2">{% trans "Stores your language preference" %}</td>
                                <td class="p-2">1 {% trans "year" %}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Functional Cookies -->
            <div class="mb-6 bg-blue-900/20 rounded-lg p-4 border border-blue-800">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-medium text-blue-300">{% trans "Functional Cookies" %}</h3>
                    <span class="bg-blue-700 text-blue-100 text-xs px-2 py-1 rounded">{% trans "Optional" %}</span>
                </div>
                <p class="text-slate-300 text-sm mb-4">
                    {% filter force_escape %}{% blocktrans %}
                    These cookies enable enhanced functionality and personalization, such as remembering your
                    preferences and providing improved features. Disabling these may affect your user experience.
                    {% endblocktrans %}{% endfilter %}
                </p>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th class="text-left p-2 text-white">{% trans "Cookie Name" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Purpose" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Duration" %}</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-300">
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">theme_preference</td>
                                <td class="p-2">{% trans "Stores your theme preference (dark/light)" %}</td>
                                <td class="p-2">1 {% trans "year" %}</td>
                            </tr>
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">sidebar_state</td>
                                <td class="p-2">{% trans "Remembers sidebar collapsed/expanded state" %}</td>
                                <td class="p-2">{% trans "Session" %}</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-mono text-xs">timezone</td>
                                <td class="p-2">{% trans "Stores your timezone for date display" %}</td>
                                <td class="p-2">1 {% trans "year" %}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics Cookies -->
            <div class="mb-6 bg-purple-900/20 rounded-lg p-4 border border-purple-800">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-medium text-purple-300">{% trans "Analytics Cookies" %}</h3>
                    <span class="bg-purple-700 text-purple-100 text-xs px-2 py-1 rounded">{% trans "Optional" %}</span>
                </div>
                <p class="text-slate-300 text-sm mb-4">
                    {% filter force_escape %}{% blocktrans %}
                    These cookies help us understand how visitors interact with our website by collecting
                    information anonymously. This helps us improve our service and user experience.
                    {% endblocktrans %}{% endfilter %}
                </p>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-700/50">
                            <tr>
                                <th class="text-left p-2 text-white">{% trans "Cookie Name" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Provider" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Purpose" %}</th>
                                <th class="text-left p-2 text-white">{% trans "Duration" %}</th>
                            </tr>
                        </thead>
                        <tbody class="text-slate-300">
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">_pk_id</td>
                                <td class="p-2">Matomo</td>
                                <td class="p-2">{% trans "Anonymous visitor identification" %}</td>
                                <td class="p-2">13 {% trans "months" %}</td>
                            </tr>
                            <tr class="border-b border-slate-700">
                                <td class="p-2 font-mono text-xs">_pk_ses</td>
                                <td class="p-2">Matomo</td>
                                <td class="p-2">{% trans "Session tracking" %}</td>
                                <td class="p-2">30 {% trans "minutes" %}</td>
                            </tr>
                            <tr>
                                <td class="p-2 font-mono text-xs">_pk_ref</td>
                                <td class="p-2">Matomo</td>
                                <td class="p-2">{% trans "Referrer source attribution" %}</td>
                                <td class="p-2">6 {% trans "months" %}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <p class="text-slate-400 text-xs mt-3">
                    {% filter force_escape %}{% blocktrans %}
                    We use Matomo, a privacy-focused analytics platform. Data is processed on our servers
                    in the EU and is not shared with third parties.
                    {% endblocktrans %}{% endfilter %}
                </p>
            </div>

            <!-- Marketing Cookies -->
            <div class="bg-amber-900/20 rounded-lg p-4 border border-amber-800">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-lg font-medium text-amber-300">{% trans "Marketing Cookies" %}</h3>
                    <span class="bg-amber-700 text-amber-100 text-xs px-2 py-1 rounded">{% trans "Optional" %}</span>
                </div>
                <p class="text-slate-300 text-sm mb-4">
                    {% filter force_escape %}{% blocktrans %}
                    These cookies are used to track visitors across websites to display relevant advertisements.
                    We currently do not use third-party marketing cookies on our platform.
                    {% endblocktrans %}{% endfilter %}
                </p>

                <div class="bg-slate-800/50 rounded p-4 text-center">
                    <p class="text-slate-400 text-sm">
                        {% trans "No marketing cookies are currently in use." %}
                    </p>
                </div>
            </div>
        </section>

        <!-- Third-Party Cookies -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "Third-Party Cookies" %}</h2>
            <p class="text-slate-300 mb-4">
                {% filter force_escape %}{% blocktrans %}
                Some cookies may be set by third-party services that appear on our pages.
                We do not control these cookies and recommend reviewing the respective privacy policies.
                {% endblocktrans %}{% endfilter %}
            </p>

            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="text-left p-3 text-white">{% trans "Provider" %}</th>
                            <th class="text-left p-3 text-white">{% trans "Purpose" %}</th>
                            <th class="text-left p-3 text-white">{% trans "Privacy Policy" %}</th>
                        </tr>
                    </thead>
                    <tbody class="text-slate-300">
                        <tr class="border-b border-slate-700">
                            <td class="p-3">Stripe</td>
                            <td class="p-3">{% trans "Payment processing fraud prevention" %}</td>
                            <td class="p-3"><a href="https://stripe.com/privacy" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">stripe.com/privacy</a></td>
                        </tr>
                        <tr class="border-b border-slate-700">
                            <td class="p-3">Cloudflare</td>
                            <td class="p-3">{% trans "CDN and security protection" %}</td>
                            <td class="p-3"><a href="https://www.cloudflare.com/privacypolicy/" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">cloudflare.com/privacypolicy</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- How to Control Cookies -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "How to Control Cookies" %}</h2>

            <h3 class="text-lg font-medium text-white mt-4 mb-3">{% trans "Using Our Cookie Banner" %}</h3>
            <p class="text-slate-300 mb-4">
                {% filter force_escape %}{% blocktrans %}
                When you first visit our website, you will see a cookie consent banner. You can:
                {% endblocktrans %}{% endfilter %}
            </p>
            <ul class="list-disc list-inside text-slate-300 space-y-1 mb-4">
                <li>{% trans "Accept all cookies" %}</li>
                <li>{% trans "Accept only essential cookies" %}</li>
                <li>{% trans "Customize your preferences for each category" %}</li>
            </ul>

            <h3 class="text-lg font-medium text-white mt-6 mb-3">{% trans "Browser Settings" %}</h3>
            <p class="text-slate-300 mb-4">
                {% filter force_escape %}{% blocktrans %}
                Most web browsers allow you to control cookies through their settings. You can:
                {% endblocktrans %}{% endfilter %}
            </p>
            <ul class="list-disc list-inside text-slate-300 space-y-1 mb-4">
                <li>{% trans "View what cookies are stored" %}</li>
                <li>{% trans "Delete cookies individually or all at once" %}</li>
                <li>{% trans "Block cookies from specific sites" %}</li>
                <li>{% trans "Block all cookies (this may affect website functionality)" %}</li>
            </ul>

            <div class="bg-slate-900/50 rounded p-4">
                <h4 class="text-white font-medium mb-2">{% trans "Browser Cookie Settings" %}</h4>
                <ul class="text-slate-300 text-sm space-y-1">
                    <li><a href="https://support.google.com/chrome/answer/95647" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">Chrome</a></li>
                    <li><a href="https://support.mozilla.org/kb/cookies-information-websites-store-on-your-computer" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">Firefox</a></li>
                    <li><a href="https://support.apple.com/guide/safari/manage-cookies-and-website-data-sfri11471" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">Safari</a></li>
                    <li><a href="https://support.microsoft.com/help/17442/windows-internet-explorer-delete-manage-cookies" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300">Edge / Internet Explorer</a></li>
                </ul>
            </div>
        </section>

        <!-- Do Not Track -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "Do Not Track Signals" %}</h2>
            <p class="text-slate-300">
                {% filter force_escape %}{% blocktrans %}
                We respect Do Not Track (DNT) browser signals. When enabled, we will not load
                optional analytics or marketing cookies until you explicitly consent.
                {% endblocktrans %}{% endfilter %}
            </p>
        </section>

        <!-- Updates -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "Updates to This Policy" %}</h2>
            <p class="text-slate-300">
                {% filter force_escape %}{% blocktrans %}
                We may update this Cookie Policy from time to time to reflect changes in our practices
                or for legal reasons. We will notify you of significant changes by updating the
                "Last updated" date and, where appropriate, through the cookie consent banner.
                {% endblocktrans %}{% endfilter %}
            </p>
        </section>

        <!-- Contact -->
        <section class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-4">{% trans "Contact Us" %}</h2>
            <p class="text-slate-300 mb-4">
                {% filter force_escape %}{% blocktrans %}
                If you have questions about our use of cookies, please contact us:
                {% endblocktrans %}{% endfilter %}
            </p>
            <div class="bg-slate-900/50 rounded p-4">
                <p class="text-slate-300"><strong class="text-white">{% trans "Email" %}:</strong> {% setting "company.email_privacy" %}</p>
                <p class="text-slate-300"><strong class="text-white">{% trans "Data Protection Officer" %}:</strong> {% setting "company.email_dpo" %}</p>
            </div>
        </section>

    </div>

    <!-- Footer Links -->
    <div class="mt-8 pt-6 border-t border-slate-700">
        <div class="flex flex-wrap gap-4 text-sm">
            <a href="{% url 'privacy_policy' %}" class="text-blue-400 hover:text-blue-300">{% trans "Privacy Policy" %}</a>
            <a href="{% url 'terms_of_service' %}" class="text-blue-400 hover:text-blue-300">{% trans "Terms of Service" %}</a>
            <a href="{% url 'data_processors' %}" class="text-blue-400 hover:text-blue-300">{% trans "Data Processors" %}</a>
        </div>
    </div>
</div>
{% endblock %}
