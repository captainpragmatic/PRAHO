{% load i18n %}
{% load ui_components %}

{% if tickets %}

<!-- Desktop Table View (hidden on mobile) -->
<div class="hidden md:block bg-slate-800/50 border border-slate-700 rounded-lg overflow-hidden">
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-700">
      <thead class="bg-slate-800">
        <tr>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Ticket' %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Subject' %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Status' %}
          </th>
          <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">
            {% trans 'Created' %}
          </th>
        </tr>
      </thead>
      <tbody class="bg-slate-800/30 divide-y divide-slate-700">
        {% for ticket in tickets %}
        <tr class="hover:bg-slate-700/50 transition-colors cursor-pointer" onclick="window.location.href='{% url 'tickets:detail' ticket_id=ticket.id %}';">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10">
                <div class="h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center">
                  <span class="text-sm font-medium text-primary">
                    {% if ticket.ticket_number %}
                    {{ ticket.ticket_number|slice:":2" }}
                    {% else %}
                    #{{ ticket.id }}
                    {% endif %}
                  </span>
                </div>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-white">
                  {% if ticket.ticket_number %}
                  {{ ticket.ticket_number }}
                  {% else %}
                  #{{ ticket.id }}
                  {% endif %}
                </div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4">
            <div class="text-sm text-slate-400 max-w-xs">
              {% if ticket.title %}{{ ticket.title }}{% elif ticket.subject %}{{ ticket.subject }}{% else %}{{ ticket.description|truncatechars:50 }}{% endif %}
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center space-x-2">
              {% if ticket.status == 'open' %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  üìÇ {% trans "Open" %}
                </span>
              {% elif ticket.status == 'in_progress' %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  ‚ö° {% trans "In Progress" %}
                </span>
              {% elif ticket.status == 'waiting_on_customer' %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  ‚è≥ {% trans "Waiting on You" %}
                </span>
              {% elif ticket.status == 'closed' %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  üìÅ {% trans "Closed" %}
                </span>
                {% if ticket.resolution_code %}
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white border text-gray-600">
                    {{ ticket.resolution_code|title }}
                  </span>
                {% endif %}
              {% else %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  {{ ticket.status|capfirst }}
                </span>
              {% endif %}

              <!-- Customer replied badge -->
              {% if ticket.customer_replied_recently %}
                <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                  üí¨
                </span>
              {% endif %}
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-400">
            {% if ticket.created_at %}
              {% with day=ticket.created_at|slice:"8:10"|add:0 month=ticket.created_at|slice:"5:7"|add:0 year=ticket.created_at|slice:":4" %}
                {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
              {% endwith %}
            {% elif ticket.date_created %}
              {% with day=ticket.date_created|slice:"8:10"|add:0 month=ticket.date_created|slice:"5:7"|add:0 year=ticket.date_created|slice:":4" %}
                {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
              {% endwith %}
            {% elif ticket.timestamp %}
              {% with day=ticket.timestamp|slice:"8:10"|add:0 month=ticket.timestamp|slice:"5:7"|add:0 year=ticket.timestamp|slice:":4" %}
                {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
              {% endwith %}
            {% elif ticket.created %}
              {% with day=ticket.created|slice:"8:10"|add:0 month=ticket.created|slice:"5:7"|add:0 year=ticket.created|slice:":4" %}
                {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
              {% endwith %}
            {% else %}
              --
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Mobile Card List (visible on mobile only) -->
<div class="sm:hidden divide-y divide-slate-700">
  {% for ticket in tickets %}
  <div class="min-h-[72px] flex flex-col justify-center p-4 hover:bg-slate-700 transition-colors cursor-pointer" onclick="window.location.href='{% url 'tickets:detail' ticket_id=ticket.id %}';">
    <div class="flex items-center justify-between mb-2">
      <div class="flex items-center space-x-2">
        <span class="text-white font-medium text-sm font-mono truncate">
          {% if ticket.ticket_number %}
          #{{ ticket.ticket_number }}
          {% else %}
          #{{ ticket.id }}
          {% endif %}
        </span>
      </div>
      <div class="text-right flex items-center space-x-2">
        {% if ticket.status == 'open' %}
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            üìÇ {% trans "Open" %}
          </span>
        {% elif ticket.status == 'in_progress' %}
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
            ‚ö° {% trans "In Progress" %}
          </span>
        {% elif ticket.status == 'waiting_on_customer' %}
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
            ‚è≥ {% trans "Waiting on You" %}
          </span>
        {% elif ticket.status == 'closed' %}
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
            üìÅ {% trans "Closed" %}
          </span>
          {% if ticket.resolution_code %}
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white border text-gray-600">
              {{ ticket.resolution_code|title }}
            </span>
          {% endif %}
        {% else %}
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
            {{ ticket.status|capfirst }}
          </span>
        {% endif %}

        <!-- Customer replied badge -->
        {% if ticket.customer_replied_recently %}
          <span class="inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
            üí¨
          </span>
        {% endif %}
      </div>
    </div>
    <div class="mb-2">
      <p class="text-white text-sm truncate">
        {% if ticket.title %}{{ ticket.title }}{% elif ticket.subject %}{{ ticket.subject }}{% else %}{{ ticket.description|truncatechars:50 }}{% endif %}
      </p>
    </div>
    <div class="flex items-center justify-between text-sm">
      <span class="text-slate-400">
        {% if ticket.created_at %}
          {% with day=ticket.created_at|slice:"8:10"|add:0 month=ticket.created_at|slice:"5:7"|add:0 year=ticket.created_at|slice:":4" %}
            {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
          {% endwith %}
        {% elif ticket.date_created %}
          {% with day=ticket.date_created|slice:"8:10"|add:0 month=ticket.date_created|slice:"5:7"|add:0 year=ticket.date_created|slice:":4" %}
            {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
          {% endwith %}
        {% elif ticket.timestamp %}
          {% with day=ticket.timestamp|slice:"8:10"|add:0 month=ticket.timestamp|slice:"5:7"|add:0 year=ticket.timestamp|slice:":4" %}
            {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
          {% endwith %}
        {% elif ticket.created %}
          {% with day=ticket.created|slice:"8:10"|add:0 month=ticket.created|slice:"5:7"|add:0 year=ticket.created|slice:":4" %}
            {{ day }} {% if month == 1 %}Jan{% elif month == 2 %}Feb{% elif month == 3 %}Mar{% elif month == 4 %}Apr{% elif month == 5 %}May{% elif month == 6 %}Jun{% elif month == 7 %}Jul{% elif month == 8 %}Aug{% elif month == 9 %}Sep{% elif month == 10 %}Oct{% elif month == 11 %}Nov{% elif month == 12 %}Dec{% endif %} {{ year }}
          {% endwith %}
        {% else %}
          --
        {% endif %}
      </span>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Use Platform Pagination Component -->
{% include 'components/pagination.html' with page_obj=paginator_data extra_params=pagination_params %}

{% else %}
<!-- Enhanced Empty State -->
<div class="bg-slate-800/50 border border-slate-700 rounded-lg">
  <div class="text-center py-12 px-6">
    <div class="mx-auto h-16 w-16 bg-slate-700 rounded-full flex items-center justify-center mb-4">
      <svg class="h-8 w-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
      </svg>
    </div>
    <h3 class="text-lg font-medium text-white mb-2">{% trans 'No Support Tickets Yet' %}</h3>
    <p class="text-slate-400 mb-6 max-w-sm mx-auto">
      {% trans 'Need help with your hosting services? Create your first support ticket and our team will assist you promptly.' %}
    </p>

    <div class="space-y-4">
      <a href="{% url 'tickets:create' %}"
        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary hover:bg-primary/90 transition-colors shadow-sm">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        {% trans 'Create Support Ticket' %}
      </a>

      <div class="text-sm text-slate-500">
        <p class="mb-2">{% trans 'Common reasons to contact support:' %}</p>
        <div class="flex flex-wrap justify-center gap-2">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
            üîß {% trans 'Technical Issues' %}
          </span>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
            üí≥ {% trans 'Billing Questions' %}
          </span>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
            üöÄ {% trans 'Service Setup' %}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
