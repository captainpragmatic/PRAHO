{% extends 'base.html' %}
{% load i18n %}
{% load ui_components %}
{% load formatting %}

{% block title %}{% trans 'Dashboard' %} - PRAHO Portal{% endblock %}

{% block content %}
<div class="px-4 sm:px-6 lg:px-8 py-6">
  <!-- Platform Connection Status -->
  {% if not platform_available %}
  <div class="mb-6 bg-red-900 border border-red-700 rounded-lg p-4">
    <div class="flex items-center">
      <span class="text-red-400 mr-2">âš ï¸</span>
      <span class="text-red-100 text-sm sm:text-base">{% trans 'Platform service temporarily unavailable. Some features may be limited.' %}</span>
    </div>
  </div>
  {% endif %}

  <!-- Header -->
  <div class="mb-6 sm:mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-white">
      ğŸ‘‹ {% trans 'Welcome to PragmaticHost' %}
    </h1>
    <p class="mt-2 text-slate-400 text-sm sm:text-base">
      {% with primary_customer=dashboard_data.customers.0 %}
      {% if primary_customer.contact_person.first_name %}
        {% blocktrans with first_name=primary_customer.contact_person.first_name %}Hello, {{ first_name }}! Here is an overview of your hosting services and account.{% endblocktrans %}
      {% else %}
        {% blocktrans with first_name=customer_email %}Hello, {{ first_name }}! Here is an overview of your hosting services and account.{% endblocktrans %}
      {% endif %}
      {% endwith %}
    </p>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8">
    <!-- My Services -->
    <div class="bg-slate-800 rounded-lg p-4 sm:p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-6 h-6 sm:w-8 sm:h-8 text-xl sm:text-2xl">ğŸš€</div>
        </div>
        <div class="ml-3 sm:ml-4">
          <p class="text-xs sm:text-sm font-medium text-slate-400">{% trans 'My Services' %}</p>
          <p class="text-lg sm:text-2xl font-semibold text-white">{{ dashboard_data.stats.active_services }}</p>
        </div>
      </div>
    </div>

    <!-- My Tickets -->
    <div class="bg-slate-800 rounded-lg p-4 sm:p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-6 h-6 sm:w-8 sm:h-8 text-xl sm:text-2xl">ğŸ«</div>
        </div>
        <div class="ml-3 sm:ml-4">
          <p class="text-xs sm:text-sm font-medium text-slate-400">{% trans 'My Open Tickets' %}</p>
          <p class="text-lg sm:text-2xl font-semibold text-white">{{ dashboard_data.stats.open_tickets }}</p>
        </div>
      </div>
    </div>

    <!-- Account Status -->
    <div class="bg-slate-800 rounded-lg p-4 sm:p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-6 h-6 sm:w-8 sm:h-8 text-xl sm:text-2xl">âœ…</div>
        </div>
        <div class="ml-3 sm:ml-4">
          <p class="text-xs sm:text-sm font-medium text-slate-400">{% trans 'Account Status' %}</p>
          <p class="text-sm sm:text-2xl font-semibold text-green-400">{% trans 'Active' %}</p>
        </div>
      </div>
    </div>

    <!-- Next Invoice -->
    <div class="bg-slate-800 rounded-lg p-4 sm:p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-6 h-6 sm:w-8 sm:h-8 text-xl sm:text-2xl">ğŸ“‹</div>
        </div>
        <div class="ml-3 sm:ml-4">
          <p class="text-xs sm:text-sm font-medium text-slate-400">{% trans 'Next Billing' %}</p>
          <p class="text-xs sm:text-sm font-semibold text-white">{% trans 'End of Month' %}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">
    <!-- Recent Invoices -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-medium text-white mb-4">
          ğŸ§¾ {% trans 'My Recent Documents' %}
        </h3>

        <div class="space-y-2 sm:space-y-3">
          {% for document in dashboard_data.recent_invoices %}
          <a href="{% if document.document_type == 'proforma' %}/billing/proformas/{{ document.number }}/{% else %}/billing/invoices/{{ document.number }}/{% endif %}" class="block group">
            <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md hover:bg-slate-600 transition-colors border border-transparent hover:border-slate-500">
              <div class="flex-1 min-w-0">
                <div class="flex items-center space-x-2 mb-1">
                  {% if document.document_type == 'proforma' %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-800 text-blue-200 flex-shrink-0">
                      ğŸ“„ <span class="hidden sm:inline ml-1">{% trans 'Proforma' %}</span>
                    </span>
                  {% else %}
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-800 text-green-200 flex-shrink-0">
                      ğŸ§¾ <span class="hidden sm:inline ml-1">{% trans 'Invoice' %}</span>
                    </span>
                  {% endif %}
                  <p class="text-white font-medium group-hover:text-blue-400 transition-colors text-sm truncate">#{{ document.number|default:document.id }}</p>
                </div>
                <p class="text-slate-400 text-xs sm:text-sm">
                  {{ document.created_at|date:"d.m.Y" }}
                </p>
              </div>
              <div class="text-right flex-shrink-0 ml-2">
                <p class="text-white font-medium text-sm mb-1">{{ document.total_display }}</p>
                <div class="text-xs">
                  {% if document.document_type == 'proforma' %}
                    {% if document.status == 'draft' %}
                      {% badge "Draft" variant="secondary" icon="ğŸ“" %}
                    {% elif document.status == 'sent' %}
                      {% badge "Sent" variant="primary" icon="ğŸ“§" %}
                    {% elif document.status == 'accepted' %}
                      {% badge "Accepted" variant="success" icon="âœ…" %}
                    {% elif document.status == 'expired' %}
                      {% badge "Expired" variant="danger" icon="â°" %}
                    {% else %}
                      {% badge document.status|title variant="secondary" %}
                    {% endif %}
                  {% else %}
                    {% if document.status == 'paid' %}
                      {% badge "Paid" variant="success" icon="âœ…" %}
                    {% elif document.status == 'overdue' %}
                      {% badge "Overdue" variant="danger" icon="âŒ" %}
                    {% else %}
                      {% badge "Pending" variant="warning" icon="â³" %}
                    {% endif %}
                  {% endif %}
                </div>
              </div>
            </div>
          </a>
          {% empty %}
          <p class="text-slate-400 text-center py-4 text-sm">
            {% trans 'No recent documents found' %}
          </p>
          {% endfor %}
        </div>

        <div class="mt-4 text-center">
          <a href="/billing/invoices/" class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm">
            {% trans 'View all documents' %} â†’
          </a>
        </div>
      </div>
    </div>

    <!-- Recent Tickets -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-medium text-white mb-4">
          ğŸ« {% trans 'My Recent Tickets' %}
        </h3>

        <div class="space-y-2 sm:space-y-3">
          {% for ticket in dashboard_data.recent_tickets %}
          <a href="/tickets/{{ ticket.id }}/" class="block group">
            <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md hover:bg-slate-600 transition-colors border border-transparent hover:border-slate-500">
              <div class="flex-1 min-w-0">
                <p class="text-white font-medium group-hover:text-blue-400 transition-colors text-sm leading-tight truncate">{{ ticket.ticket_number|default:ticket.id }} - {{ ticket.title }}</p>
                <p class="text-slate-400 text-xs sm:text-sm mt-1">
                  {{ ticket.created_at|date:"d.m.Y" }}
                </p>
              </div>
              <div class="flex-shrink-0 ml-2">
                {% if ticket.priority == 'high' %}
                  {% badge "Urgent" variant="danger" icon="ğŸ”´" %}
                {% elif ticket.priority == 'medium' %}
                  {% badge "Medium" variant="warning" icon="ğŸŸ¡" %}
                {% else %}
                  {% badge "Low" variant="success" icon="ğŸŸ¢" %}
                {% endif %}
              </div>
            </div>
          </a>
          {% empty %}
          <p class="text-slate-400 text-center py-4 text-sm">
            {% trans 'No recent support tickets' %}
          </p>
          {% endfor %}
        </div>

        <div class="mt-4 text-center">
          <a href="/tickets/" class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm">
            {% trans 'View my tickets' %} â†’
          </a>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-medium text-white mb-4">
          âš¡ {% trans 'Quick Actions' %}
        </h3>

        <div class="grid grid-cols-2 gap-2 sm:gap-3">
          <a href="/tickets/new/" class="inline-flex items-center justify-center px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-white bg-red-600 border border-red-600 rounded-lg hover:bg-red-700 focus:ring-4 focus:ring-red-300 transition-all duration-200">
            <span class="text-base sm:text-lg mr-1">ğŸ«</span>
            <span class="hidden sm:inline">{% trans 'New Ticket' %}</span>
            <span class="sm:hidden">{% trans 'Ticket' %}</span>
          </a>
          <a href="/billing/invoices/" class="inline-flex items-center justify-center px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-white bg-green-600 border border-green-600 rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 transition-all duration-200">
            <span class="text-base sm:text-lg mr-1">ğŸ“„</span>
            <span class="hidden sm:inline">{% trans 'View Invoices' %}</span>
            <span class="sm:hidden">{% trans 'Invoices' %}</span>
          </a>
          <a href="/services/" class="inline-flex items-center justify-center px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-white bg-slate-600 border border-slate-600 rounded-lg hover:bg-slate-700 focus:ring-4 focus:ring-slate-300 transition-all duration-200">
            <span class="text-base sm:text-lg mr-1">ğŸš€</span>
            <span class="hidden sm:inline">{% trans 'My Services' %}</span>
            <span class="sm:hidden">{% trans 'Services' %}</span>
          </a>
          <a href="/users/profile/" class="inline-flex items-center justify-center px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium text-white bg-yellow-500 border border-yellow-500 rounded-lg hover:bg-yellow-600 focus:ring-4 focus:ring-yellow-300 transition-all duration-200">
            <span class="text-base sm:text-lg mr-1">ğŸ‘¤</span>
            <span class="hidden sm:inline">{% trans 'My Profile' %}</span>
            <span class="sm:hidden">{% trans 'Profile' %}</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Account Information -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-4 sm:p-6">
        <h3 class="text-base sm:text-lg font-medium text-white mb-4">
          ğŸ¢ {% trans 'Account Information' %}
        </h3>

        <div class="space-y-2 sm:space-y-3">
          {% with primary_customer=dashboard_data.customers.0 %}
          {% if primary_customer %}
          <div class="flex items-center justify-between">
            <span class="text-slate-300 text-sm">{% trans 'Company' %}</span>
            <span class="text-white font-medium text-sm text-right flex-1 ml-2 truncate">{{ primary_customer.company_name|default:primary_customer.name }}</span>
          </div>

          {% if primary_customer.tax_profile.vat_number %}
          <div class="flex items-center justify-between">
            <span class="text-slate-300 text-sm">{% trans 'VAT Number' %}</span>
            <span class="text-white text-sm">{{ primary_customer.tax_profile.vat_number }}</span>
          </div>
          {% endif %}

          <div class="flex items-center justify-between">
            <span class="text-slate-300 text-sm">{% trans 'Customer Since' %}</span>
            <span class="text-white text-sm">{{ primary_customer.created_at|date:"M Y" }}</span>
          </div>
          {% endif %}
          {% endwith %}

          <div class="flex items-center justify-between">
            <span class="text-slate-300 text-sm">{% trans 'Support Level' %}</span>
            <span class="inline-flex items-center text-green-400 text-sm">
              âœ… {% trans 'Standard' %}
            </span>
          </div>
        </div>

        <div class="mt-4 pt-4 border-t border-slate-700">
          <p class="text-slate-400 text-xs">
            {% trans 'Need help?' %}
            <a href="/tickets/new/" class="text-blue-400 hover:text-blue-300">
              {% trans 'Contact Support' %}
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
  </div>

</div>
</div>
{% endblock %}