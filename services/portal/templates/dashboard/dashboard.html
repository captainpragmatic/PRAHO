{% extends 'base.html' %}
{% load i18n %}
{% load ui_components %}
{% load formatting %}

{% block title %}{% trans 'Dashboard' %} - PRAHO Portal{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Platform Connection Status -->
  {% if not platform_available %}
  <div class="mb-6 bg-red-900 border border-red-700 rounded-lg p-4">
    <div class="flex items-center">
      <span class="text-red-400 mr-2">⚠️</span>
      <span class="text-red-100">{% trans 'Platform service temporarily unavailable. Some features may be limited.' %}</span>
    </div>
  </div>
  {% endif %}

  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-white">
      👋 {% trans 'Welcome to Your Dashboard' %}
    </h1>
    <p class="mt-2 text-slate-400">
      {% trans 'Here is an overview of your hosting services and account.' %}
    </p>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- My Services -->
    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 text-2xl">🚀</div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-slate-400">{% trans 'My Services' %}</p>
          <p class="text-2xl font-semibold text-white">{{ dashboard_data.stats.active_services }}</p>
        </div>
      </div>
    </div>

    <!-- My Tickets -->
    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 text-2xl">🎫</div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-slate-400">{% trans 'Open Tickets' %}</p>
          <p class="text-2xl font-semibold text-white">{{ dashboard_data.stats.open_tickets }}</p>
        </div>
      </div>
    </div>

    <!-- Account Status -->
    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 text-2xl">✅</div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-slate-400">{% trans 'Account Status' %}</p>
          <p class="text-2xl font-semibold text-green-400">{% trans 'Active' %}</p>
        </div>
      </div>
    </div>

    <!-- Total Invoices -->
    <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="w-8 h-8 text-2xl">📋</div>
        </div>
        <div class="ml-4">
          <p class="text-sm font-medium text-slate-400">{% trans 'Total Invoices' %}</p>
          <p class="text-2xl font-semibold text-white">{{ dashboard_data.stats.total_invoices }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Recent Invoices -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-6">
        <h3 class="text-lg font-medium text-white mb-4">
          🧾 {% trans 'My Recent Invoices' %}
        </h3>

        <div class="space-y-3">
          {% for invoice in dashboard_data.recent_invoices %}
          <div class="block">
            <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md hover:bg-slate-600 transition-colors border border-transparent hover:border-slate-500">
              <div>
                <p class="text-white font-medium">{% trans 'Invoice' %} #{{ invoice.invoice_number|default:invoice.id }}</p>
                <p class="text-slate-400 text-sm">
                  {{ invoice.created_at|date:"d.m.Y" }}
                </p>
              </div>
              <div class="text-right">
                <p class="text-white font-medium">{{ invoice.total|floatformat:2 }} RON</p>
                {% if invoice.status == 'paid' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-800 text-green-200">
                    ✅ {% trans 'Paid' %}
                  </span>
                {% elif invoice.status == 'overdue' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-800 text-red-200">
                    ❌ {% trans 'Overdue' %}
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-800 text-yellow-200">
                    ⏳ {% trans 'Pending' %}
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-slate-400 text-center py-4">
            {% trans 'No recent invoices found' %}
          </p>
          {% endfor %}
        </div>

        <div class="mt-4 text-center">
          <a href="#" class="inline-flex items-center text-blue-400 hover:text-blue-300">
            {% trans 'View all invoices' %} →
          </a>
        </div>
      </div>
    </div>

    <!-- Recent Tickets -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-6">
        <h3 class="text-lg font-medium text-white mb-4">
          🎫 {% trans 'My Recent Tickets' %}
        </h3>

        <div class="space-y-3">
          {% for ticket in dashboard_data.recent_tickets %}
          <div class="block">
            <div class="flex items-center justify-between p-3 bg-slate-700 rounded-md hover:bg-slate-600 transition-colors border border-transparent hover:border-slate-500">
              <div>
                <p class="text-white font-medium leading-5">{{ ticket.ticket_number|default:ticket.id }} - {{ ticket.title }}</p>
                <p class="text-slate-400 text-sm">
                  {{ ticket.created_at|date:"d.m.Y" }}
                </p>
              </div>
              <div class="text-right">
                {% if ticket.priority == 'high' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-800 text-red-200">
                    🔴 {% trans 'Urgent' %}
                  </span>
                {% elif ticket.priority == 'medium' %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-800 text-yellow-200">
                    🟡 {% trans 'Medium' %}
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-800 text-green-200">
                    🟢 {% trans 'Low' %}
                  </span>
                {% endif %}
              </div>
            </div>
          </div>
          {% empty %}
          <p class="text-slate-400 text-center py-4">
            {% trans 'No recent support tickets' %}
          </p>
          {% endfor %}
        </div>

        <div class="mt-4 text-center">
          <a href="#" class="inline-flex items-center text-blue-400 hover:text-blue-300">
            {% trans 'View all tickets' %} →
          </a>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-6">
        <h3 class="text-lg font-medium text-white mb-4">
          ⚡ {% trans 'Quick Actions' %}
        </h3>

        <div class="grid grid-cols-2 gap-3">
          <a href="#" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-red-600 border border-red-600 rounded-lg hover:bg-red-700 focus:ring-4 focus:ring-red-300 transition-all duration-200">
            🎫 {% trans 'New Ticket' %}
          </a>
          <a href="#" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-green-600 border border-green-600 rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 transition-all duration-200">
            📄 {% trans 'View Invoices' %}
          </a>
          <a href="#" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-slate-600 border border-slate-600 rounded-lg hover:bg-slate-700 focus:ring-4 focus:ring-slate-300 transition-all duration-200">
            🚀 {% trans 'My Services' %}
          </a>
          <a href="#" class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 border border-yellow-500 rounded-lg hover:bg-yellow-600 focus:ring-4 focus:ring-yellow-300 transition-all duration-200">
            👤 {% trans 'My Profile' %}
          </a>
        </div>
      </div>
    </div>

    <!-- Account Information -->
    <div class="bg-slate-800 rounded-lg border border-slate-700">
      <div class="p-6">
        <h3 class="text-lg font-medium text-white mb-4">
          🏢 {% trans 'Account Information' %}
        </h3>

        <div class="space-y-3">
          {% with primary_customer=dashboard_data.customers.0 %}
          {% if primary_customer %}
          <div class="flex items-center justify-between">
            <span class="text-slate-300">{% trans 'Company' %}</span>
            <span class="text-white font-medium">{{ primary_customer.company_name|default:primary_customer.name }}</span>
          </div>

          {% if primary_customer.tax_profile.vat_number %}
          <div class="flex items-center justify-between">
            <span class="text-slate-300">{% trans 'VAT Number' %}</span>
            <span class="text-white">{{ primary_customer.tax_profile.vat_number }}</span>
          </div>
          {% endif %}

          <div class="flex items-center justify-between">
            <span class="text-slate-300">{% trans 'Customer Since' %}</span>
            <span class="text-white">{{ primary_customer.created_at|date:"M Y" }}</span>
          </div>
          {% endif %}
          {% endwith %}

          <div class="flex items-center justify-between">
            <span class="text-slate-300">{% trans 'Support Level' %}</span>
            <span class="inline-flex items-center text-green-400">
              ✅ {% trans 'Standard' %}
            </span>
          </div>
        </div>

        <div class="mt-4 pt-4 border-t border-slate-700">
          <p class="text-slate-400 text-xs">
            {% trans 'Need help?' %}
            <a href="#" class="text-blue-400 hover:text-blue-300">
              {% trans 'Contact Support' %}
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}