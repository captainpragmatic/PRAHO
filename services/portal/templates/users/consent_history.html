{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans 'Consent History' %} - PragmaticHost{% endblock %}

{% block content %}
<div class="px-4 py-6 max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-white romanian-flag">
      ğŸ“œ {% trans 'Consent History' %}
    </h1>
    <p class="mt-2 text-sm text-slate-400">
      {% trans 'View and manage your GDPR consents and marketing preferences' %}
    </p>
  </div>

  <!-- Current Consent Status -->
  <div class="bg-slate-800 shadow-sm ring-1 ring-slate-700 rounded-lg mb-6">
    <div class="p-6">
      <h3 class="text-lg font-medium text-white mb-4">
        ğŸ“Š {% trans 'Current Consent Status' %}
      </h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Data Processing Consent -->
        <div class="p-4 bg-slate-700 rounded-lg">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <span class="text-green-400 mr-2">ğŸ”’</span>
              <h4 class="text-sm font-medium text-white">{% trans 'Data Processing' %}</h4>
            </div>
            {% if profile.gdpr_consent_date %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                âœ… {% trans 'Active' %}
              </span>
            {% else %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                âŒ {% trans 'Inactive' %}
              </span>
            {% endif %}
          </div>
          <p class="text-xs text-slate-400 mb-2">{% trans 'Required for account operation and service delivery' %}</p>
          {% if profile.gdpr_consent_date %}
            <p class="text-xs text-slate-500">{% trans 'Granted on:' %} {{ profile.gdpr_consent_date|date:"M d, Y" }}</p>
          {% endif %}
        </div>

        <!-- Marketing Consent -->
        <div class="p-4 bg-slate-700 rounded-lg">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center">
              <span class="text-blue-400 mr-2">ğŸ“§</span>
              <h4 class="text-sm font-medium text-white">{% trans 'Marketing Communications' %}</h4>
            </div>
            {% if profile.accepts_marketing %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                âœ… {% trans 'Enabled' %}
              </span>
            {% else %}
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                ğŸ“› {% trans 'Disabled' %}
              </span>
            {% endif %}
          </div>
          <p class="text-xs text-slate-400 mb-2">{% trans 'Newsletters, promotional emails, and service updates' %}</p>
          <p class="text-xs text-slate-500">
            {% if profile.accepts_marketing %}
              {% trans 'You can unsubscribe at any time from any marketing email' %}
            {% else %}
              {% trans 'You have opted out of marketing communications' %}
            {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Consent History Timeline -->
  <div class="bg-slate-800 shadow-sm ring-1 ring-slate-700 rounded-lg mb-6">
    <div class="p-6">
      <h3 class="text-lg font-medium text-white mb-4">
        ğŸ“… {% trans 'Data Processing Consent Timeline' %}
      </h3>

      <div class="space-y-4">
        {% for consent in consent_history %}
        <div class="flex items-start p-4 bg-slate-700 rounded-lg">
          <div class="flex-shrink-0 w-12 h-12 bg-slate-600 rounded-lg flex items-center justify-center mr-4">
            {% if consent.status == 'success' %}
              <span class="text-green-400">âœ…</span>
            {% elif consent.status == 'initiated' %}
              <span class="text-blue-400">ğŸ”„</span>
            {% else %}
              <span class="text-yellow-400">â¸ï¸</span>
            {% endif %}
          </div>

          <div class="flex-1">
            <div class="flex items-center justify-between mb-1">
              <h4 class="text-sm font-medium text-white">{{ consent.description }}</h4>
              <span class="text-xs text-slate-400">{{ consent.timestamp }}</span>
            </div>
            <p class="text-sm text-slate-300 mb-1">
              <span class="font-medium">{% trans 'Status:' %}</span>
              <span class="{% if consent.status == 'success' %}text-green-400{% elif consent.status == 'completed' %}text-green-400{% else %}text-yellow-400{% endif %}">
                {{ consent.status }}
              </span>
            </p>
          </div>
        </div>
        {% empty %}
        <div class="text-center text-slate-400 py-8">
          <span class="text-4xl mb-4 block">ğŸ“­</span>
          <p>{% trans 'No consent history available' %}</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Cookie Consent History -->
  {% if cookie_consent_history %}
  <div class="bg-slate-800 shadow-sm ring-1 ring-slate-700 rounded-lg mb-6">
    <div class="p-6">
      <h3 class="text-lg font-medium text-white mb-4">
        &#127850; {% trans 'Cookie Consent History' %}
      </h3>

      <div class="space-y-4">
        {% for cookie in cookie_consent_history %}
        <div class="flex items-start p-4 bg-slate-700 rounded-lg">
          <div class="flex-shrink-0 w-12 h-12 bg-slate-600 rounded-lg flex items-center justify-center mr-4">
            {% if cookie.status == 'accepted_all' %}
              <span class="text-green-400">âœ…</span>
            {% elif cookie.status == 'accepted_essential' %}
              <span class="text-yellow-400">ğŸ”’</span>
            {% elif cookie.status == 'customized' %}
              <span class="text-blue-400">âš™ï¸</span>
            {% else %}
              <span class="text-red-400">âŒ</span>
            {% endif %}
          </div>

          <div class="flex-1">
            <div class="flex items-center justify-between mb-1">
              <h4 class="text-sm font-medium text-white">
                {% if cookie.status == 'accepted_all' %}{% trans 'All Cookies Accepted' %}
                {% elif cookie.status == 'accepted_essential' %}{% trans 'Essential Only' %}
                {% elif cookie.status == 'customized' %}{% trans 'Custom Preferences' %}
                {% elif cookie.status == 'withdrawn' %}{% trans 'Consent Withdrawn' %}
                {% else %}{{ cookie.status }}{% endif %}
              </h4>
              <span class="text-xs text-slate-400">{{ cookie.updated_at }}</span>
            </div>
            <div class="flex flex-wrap gap-2 mt-2">
              <span class="text-xs px-2 py-0.5 rounded bg-green-800 text-green-200">{% trans 'Essential' %}</span>
              {% if cookie.functional %}
                <span class="text-xs px-2 py-0.5 rounded bg-blue-800 text-blue-200">{% trans 'Functional' %}</span>
              {% endif %}
              {% if cookie.analytics %}
                <span class="text-xs px-2 py-0.5 rounded bg-yellow-800 text-yellow-200">{% trans 'Analytics' %}</span>
              {% endif %}
              {% if cookie.marketing %}
                <span class="text-xs px-2 py-0.5 rounded bg-red-800 text-red-200">{% trans 'Marketing' %}</span>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Manage Preferences -->
  <div class="bg-slate-800 shadow-sm ring-1 ring-slate-700 rounded-lg mb-6">
    <div class="p-6">
      <h3 class="text-lg font-medium text-white mb-4">
        âš™ï¸ {% trans 'Manage Preferences' %}
      </h3>
      
      <div class="space-y-3">
        <div class="p-4 bg-slate-700 rounded-lg">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <h4 class="text-sm font-medium text-white">{% trans 'Marketing Emails' %}</h4>
              <p class="text-xs text-slate-400">{% trans 'Receive newsletters and promotional content' %}</p>
            </div>
            <div class="ml-4">
              {% if profile.accepts_marketing %}
                <button class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs transition-colors">
                  ğŸš« {% trans 'Unsubscribe' %}
                </button>
              {% else %}
                <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs transition-colors">
                  âœ… {% trans 'Subscribe' %}
                </button>
              {% endif %}
            </div>
          </div>
        </div>
        
        <div class="p-4 bg-slate-700/50 rounded-lg border border-slate-600">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <h4 class="text-sm font-medium text-white">{% trans 'Essential Communications' %}</h4>
              <p class="text-xs text-slate-400">{% trans 'Account security, billing, and service notifications' %}</p>
            </div>
            <div class="ml-4">
              <span class="bg-slate-600 text-slate-300 px-3 py-1 rounded text-xs cursor-not-allowed">
                {% trans 'Required' %}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Legal Information -->
  <div class="bg-slate-800 shadow-sm ring-1 ring-slate-700 rounded-lg">
    <div class="p-6">
      <h3 class="text-lg font-medium text-white mb-4">
        âš–ï¸ {% trans 'Legal Information' %}
      </h3>
      
      <div class="text-sm text-slate-300 space-y-2">
        <p>
          {% trans 'You can withdraw your consent at any time by contacting our support team or using the preference controls above.' %}
        </p>
        <p>
          {% trans 'Withdrawal of consent does not affect the lawfulness of processing based on consent before withdrawal.' %}
        </p>
        <p>
          {% trans 'Essential communications (billing, security, service updates) cannot be disabled as they are necessary for service delivery.' %}
        </p>
        <p class="text-xs text-slate-400 pt-2">
          ğŸ‡·ğŸ‡´ {% trans 'GDPR Article 7 - Conditions for consent | Romanian Law 190/2018' %}
        </p>
      </div>
    </div>
  </div>

  <!-- Back to Privacy Dashboard -->
  <div class="mt-6 text-center">
    <a href="{% url 'users:privacy_dashboard' %}" 
       class="text-slate-400 hover:text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
      â† {% trans 'Back to Privacy Dashboard' %}
    </a>
  </div>
</div>
{% endblock %}