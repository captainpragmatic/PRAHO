{% comment %}
Dangerous Action Confirmation Modal

A modal component for confirming dangerous operations like deleting Virtualmin accounts.
Requires user to type a specific confirmation phrase to enable the action.

Usage:
{% include "components/dangerous_action_modal.html" %}

Triggered via Alpine.js event:
$dispatch('confirm-dangerous-action', {
    title: 'Delete Account',
    message: 'Type "I really am sure I want to do this!" to confirm',
    confirmText: 'I really am sure I want to do this!',
    action: () => { /* your action */ }
});
{% endcomment %}

<!-- Dangerous Action Confirmation Modal -->
<div x-data="{
    show: false,
    title: '',
    message: '',
    confirmText: '',
    userInput: '',
    action: null,

    open(data) {
        this.title = data.title || 'Confirm Action';
        this.message = data.message || 'Are you sure?';
        this.confirmText = data.confirmText || 'I understand';
        this.userInput = '';
        this.action = data.action;
        this.show = true;
    },

    close() {
        this.show = false;
        this.userInput = '';
        this.action = null;
    },

    confirm() {
        if (this.userInput === this.confirmText && this.action) {
            this.action();
            this.close();
        }
    },

    get isValid() {
        return this.userInput === this.confirmText;
    }
}"
@confirm-dangerous-action.window="open($event.detail)"
x-show="show"
x-cloak
class="fixed inset-0 z-50 overflow-y-auto"
x-transition:enter="ease-out duration-300"
x-transition:enter-start="opacity-0"
x-transition:enter-end="opacity-100"
x-transition:leave="ease-in duration-200"
x-transition:leave-start="opacity-100"
x-transition:leave-end="opacity-0">

    <!-- Background overlay -->
    <div class="fixed inset-0 bg-black bg-opacity-50" @click="close()"></div>

    <!-- Modal container -->
    <div class="relative min-h-screen flex items-center justify-center p-4">
        <div class="relative bg-slate-800 rounded-lg border border-slate-700 shadow-xl max-w-md w-full"
             x-transition:enter="ease-out duration-300"
             x-transition:enter-start="opacity-0 transform scale-95"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="ease-in duration-200"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-95"
             @click.stop>

            <!-- Header -->
            <div class="px-6 py-4 border-b border-slate-700">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-red-400 text-2xl">⚠️</span>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-lg font-medium text-slate-100" x-text="title">
                            Dangerous Action
                        </h3>
                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="px-6 py-4">
                <div class="text-sm text-slate-300 mb-4" x-html="message">
                    This action cannot be undone.
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">
                            Type the following to confirm:
                        </label>
                        <div class="bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm font-mono text-slate-300 mb-3">
                            <span x-text="confirmText">I really am sure I want to do this!</span>
                        </div>
                        <input type="text"
                               x-model="userInput"
                               @keyup.enter="isValid && confirm()"
                               class="w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-md text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
                               placeholder="Type confirmation text here..."
                               autocomplete="off">
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="px-6 py-4 border-t border-slate-700 flex justify-end space-x-3">
                <button type="button"
                        @click="close()"
                        class="px-4 py-2 text-sm font-medium text-slate-300 bg-slate-700 border border-slate-600 rounded-md hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-500 transition-colors">
                    Cancel
                </button>
                <button type="button"
                        @click="confirm()"
                        :disabled="!isValid"
                        :class="isValid ? 'bg-red-600 hover:bg-red-700 focus:ring-red-500' : 'bg-slate-600 cursor-not-allowed'"
                        class="px-4 py-2 text-sm font-medium text-white border border-transparent rounded-md focus:outline-none focus:ring-2 transition-colors">
                    Confirm
                </button>
            </div>
        </div>
    </div>
</div>
